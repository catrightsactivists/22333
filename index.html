<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘æ°´åº„å›­çš„ç§˜å¯†</title>
    <style>
        /* [ä¹‹å‰çš„æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜] */
        /* åŸºç¡€æ ·å¼ */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Times New Roman', serif;
            background-color: black;
            color: #e0d3b8;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            cursor: default;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* å¼€åœºæ–‡å­— */
        #opening-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8em;
            text-align: center;
            opacity: 0;
            z-index: 99;
            text-shadow: 0 0 10px rgba(224, 211, 184, 0.7);
            animation: fadeInOut 6s ease-in-out forwards;
            pointer-events: none;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            30% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* å¤§å…è§†å›¾ */
        #hall-view {
            width: 80vmin;
            height: 80vmin;
            position: relative;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #2a1f1a;
        }

        /* äº¤äº’æŒ‰é’® */
        .interaction-dot {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: rgba(224, 211, 184, 0.3);
            border: 2px solid #e0d3b8;
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .interaction-dot:hover {
            background-color: rgba(224, 211, 184, 0.7);
            transform: translate(-50%, -50%) scale(1.2);
        }

        /* æŒ‰é’®æç¤ºæ–‡å­— */
        .dot-tooltip {
            position: absolute;
            background-color: rgba(42, 31, 26, 0.9);
            color: #e0d3b8;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 20;
            border: 1px solid #e0d3b8;
        }

        .interaction-dot:hover .dot-tooltip {
            opacity: 1;
        }

        /* ç‰¹å†™è§†å›¾ */
        #closeup-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #2a1f1a;
            transition: opacity 1s ease-in-out;
        }

        #closeup-view.active {
            opacity: 1;
            pointer-events: all;
        }

        /* è¿”å›æŒ‰é’® */
        #return-button {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: rgba(90, 70, 50, 0.7);
            color: #e0d3b8;
            border: 1px solid #e0d3b8;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: inherit;
            z-index: 30;
        }

        #return-button:hover {
            background-color: rgba(120, 90, 60, 0.9);
        }

        #closeup-view.active #return-button {
            opacity: 1;
        }

        /* å¼€å§‹æ¸¸æˆæŒ‰é’®çš„ç‰¹æ®Šæ ·å¼ */
        #start-dot .dot-tooltip {
            font-style: italic;
            color: #a08c6c;
        }

        /* å­é¡µé¢äº¤äº’å…ƒç´ æ ·å¼ */
        .interactive-element {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interactive-element:hover {
            transform: scale(1.05);
        }

        .puzzle-interface {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(42, 31, 26, 0.95);
            padding: 30px;
            border: 2px solid #e0d3b8;
            border-radius: 10px;
            min-width: 300px;
            z-index: 40;
        }

        .puzzle-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
            color: #d4af37;
        }

        .puzzle-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .puzzle-button {
            padding: 8px 16px;
            background-color: rgba(90, 70, 50, 0.7);
            color: #e0d3b8;
            border: 1px solid #e0d3b8;
            cursor: pointer;
            font-family: inherit;
        }

        .puzzle-button:hover {
            background-color: rgba(120, 90, 60, 0.9);
        }
           /* é­”è¯é¡µé¢æ ·å¼ - ç›´æ¥å¤åˆ¶å°±è¡Œ */
.door-interface {
    background: rgba(42,31,26,0.95);
    padding: 20px;
    border: 2px solid #e0d3b8;
    border-radius: 10px;
    max-width: 500px;
    margin: 20px auto;
}
.door-title {
    text-align: center;
    font-size: 1.5em;
    color: #d4af37;
    margin-bottom: 10px;
}
.door-subtitle {
    text-align: center;
    color: #a08c6c;
    margin-bottom: 20px;
}
.ingredient {
    padding: 8px;
    margin: 5px 0;
    background: rgba(139,69,19,0.3);
    border: 1px solid #8b4513;
    border-radius: 5px;
    cursor: pointer;
}
.ingredient:hover {
    background: rgba(139,69,19,0.5);
}
.step {
    padding: 5px 0;
}
.success-message {
    color: #6b8e23;
    padding: 10px;
    background: rgba(107,142,35,0.1);
    border-radius: 5px;
}
.error-message {
    color: #8b4513;
    padding: 10px;
    background: rgba(139,69,19,0.1);
    border-radius: 5px;
}
.controls-container {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}
.door-button {
    padding: 8px 16px;
    background: rgba(90,70,50,0.7);
    color: #e0d3b8;
    border: 1px solid #e0d3b8;
    cursor: pointer;
}
.door-button:hover {
    background: rgba(120,90,60,0.9);
}
.hint-text {
    text-align: center;
    margin-top: 15px;
    color: #a08c6c;
}

    </style>
</head>
<body>
    <div id="game-container">
        <div id="opening-text">ä½ åœ¨ä¸€ä¸ªé™Œç”Ÿçš„ä¹¦æˆ¿ä¸­é†’æ¥ï¼Œè¯·å°è¯•æ¢ç´¢æ•´ä¸ªæˆ¿é—´ï¼Œæ‰¾å›ä¸¢å¤±çš„è®°å¿†</div>
        <div id="hall-view"></div>
        <div id="closeup-view">
            <button id="return-button">â† è¿”å›å¤§å…</button>
        </div>
    </div>

    <script>
        // ==================== å›¾ç‰‡é…ç½®åŒºåŸŸ ====================
        const IMAGES = {
            HALL: 'back.jpg',
            DESK: 'bigdesk.jpg',
            DOOR: 'door.jpg',
            PAINTING: 'paint.jpg',
            MAP: 'map.jpg',
            FAMILY_TREE: 'familytree.jpg',
            POTION_TABLE: 'desk.jpg'
        };

        // ==================== å­é¡µé¢äº¤äº’é…ç½® ====================
        const PAGE_INTERACTIONS = {
            // ä¹¦æ¡Œé¡µé¢äº¤äº’
            desk: {
                background: IMAGES.DESK,
                interactions: [
                    {
                        type: 'clickable',
                        element: '<div class="interactive-element" style="width: 100px; height: 100px; top: 30%; left: 25%; background-color: rgba(139, 69, 19, 0.5); border: 2px dashed #8b4513; border-radius: 5px;"></div>',
                        action: () => showPuzzle('ä¹¦æ¡ŒæŠ½å±‰', 'ä½ å‘ç°äº†ä¸€ä¸ªä¸Šé”çš„æŠ½å±‰ã€‚éœ€è¦æ‰¾åˆ°é’¥åŒ™æ‰èƒ½æ‰“å¼€ã€‚', [
                            { text: 'å°è¯•æ’¬å¼€', action: () => alert('æ’¬é”å¤±è´¥äº†ï¼è¿™éœ€è¦ä¸“é—¨çš„å·¥å…·ã€‚') },
                            { text: 'å¯»æ‰¾é’¥åŒ™', action: () => alert('ä½ å†³å®šåœ¨æˆ¿é—´å…¶ä»–åœ°æ–¹å¯»æ‰¾é’¥åŒ™ã€‚') },
                            { text: 'æš‚æ—¶æ”¾å¼ƒ', action: () => closePuzzle() }
                        ])
                    },
                    {
                        type: 'puzzle',
                        element: '<div class="interactive-element" style="width: 80px; height: 120px; top: 45%; left: 60%; background-color: rgba(106, 90, 205, 0.5); border: 2px dashed #6a5acd; border-radius: 3px;"></div>',
                        action: () =>  showDeskPuzzle()
                    }
                ]
            },

            // å¤§é—¨é¡µé¢äº¤äº’
            door: {
                background: IMAGES.DOOR,
                interactions: [
                    {
                        type: 'puzzle',
                        element: '',
                        action: () => showDoorPuzzle()
                    }
                ]
            },

            // æ²¹ç”»é¡µé¢äº¤äº’
            painting: {
                background: IMAGES.PAINTING,
                interactions: [
                    {
                        type: 'puzzle',
                        element: '<div class="interactive-element" style="width: 120px; height: 80px; top: 40%; left: 50%; background-color: rgba(255, 215, 0, 0.3); border: 2px dashed #ffd700; border-radius: 5px;"></div>',
                        action: () => showPaintingPuzzle()
                    }
                ]
            },

            // åœ°å›¾é¡µé¢äº¤äº’
            map: {
                background: IMAGES.MAP,
                interactions: [
                    {
                        type: 'puzzle',
                        element: '<div class="interactive-element" style="width: 60px; height: 60px; top: 35%; left: 50%; background-color: rgba(220, 20, 60, 0.4); border-radius: 50%;"></div>',
                        action: () => showMapPuzzle()
                    }
                ]
            },

            // å®¶æ—æ ‘é¡µé¢äº¤äº’
            'family-tree': {
                background: IMAGES.FAMILY_TREE,
                interactions: [
                    {
                        type: 'puzzle',
                        element: '<div class="interactive-element" style="width: 40px; height: 40px; top: 45%; left: 40%; background-color: rgba(178, 34, 34, 0.5); border-radius: 50%;"></div>',
                        action: () =>showFamilyTreePuzzle()
                    }
                ]
            },

            // é­”è¯æ¡Œå­é¡µé¢äº¤äº’
            'potion-table': {
                background: IMAGES.POTION_TABLE,
                interactions: [
                    {
                    type: 'puzzle', 
                          element: '<div style="width:100px;height:80px;position:absolute;top:60%;left:50%;background:rgba(76,175,80,0.3);border:2px dashed #4caf50;"></div>',
                action: () => showPotionPuzzle()
                    }
                ]
            }
        };

        // ==================== å¢™é¢é…ç½® ====================
        const walls = [
            { 
                id: 'desk', 
                name: 'ä¹¦æ¡Œ', 
                hint: 'å®¶ä¸»çš„ä¹¦æ¡Œä¸æ¡£æ¡ˆ',
                position: 'north',
                tooltipPos: 'bottom'
            },
            { 
                id: 'door', 
                name: 'å¤§é—¨', 
                hint: 'ä¸€æ‰‡å¸¦æœ‰ä¸ƒä¸ªé”å­”çš„é»„é“œå¤§é—¨',
                position: 'northwest',
                tooltipPos: 'bottom-right'
            },
            { 
                id: 'painting', 
                name: 'æ²¹ç”»', 
                hint: 'ä¸€å¹…å·¨å¤§çš„å¤å…¸æ²¹ç”»',
                position: 'northeast',
                tooltipPos: 'bottom-left'
            },
            { 
                id: 'map', 
                name: 'åœ°å›¾', 
                hint: 'ä»¥åº„å›­ä¸ºä¸­å¿ƒçš„ä¸–ç•Œåœ°å›¾',
                position: 'east',
                tooltipPos: 'left'
            },
            { 
                id: 'family-tree', 
                name: 'å®¶æ—æ ‘', 
                hint: 'ä¸€ä»½è¢«æ±¡æŸçš„å®¶æ—è°±ç³»',
                position: 'southeast',
                tooltipPos: 'top-left'
            },
            { 
                id: 'potion-table', 
                name: 'é­”è¯æ¡Œå­', 
                hint: 'ç‚¼é‡‘æœ¯å·¥ä½œå°ä¸æ‰‹ç¨¿',
                position: 'south',
                tooltipPos: 'top'
            },
            { 
                id: 'start', 
                name: 'å¼€å§‹æ¸¸æˆ', 
                hint: 'ç‚¹å‡»è¿™é‡Œå¼€å§‹æ¢ç´¢',
                position: 'southwest',
                tooltipPos: 'top-right',
                isStart: true
            }
        ];

        // ==================== å·¥å…·å‡½æ•° ====================
        function getPosition(position) {
            const radius = 40;
            switch(position) {
                case 'north': return { x: 50, y: 50 - radius };
                case 'northeast': return { x: 50 + radius * 0.707, y: 50 - radius * 0.707 };
                case 'east': return { x: 50 + radius, y: 50 };
                case 'southeast': return { x: 50 + radius * 0.707, y: 50 + radius * 0.707 };
                case 'south': return { x: 50, y: 50 + radius };
                case 'southwest': return { x: 50 - radius * 0.707, y: 50 + radius * 0.707 };
                case 'west': return { x: 50 - radius, y: 50 };
                case 'northwest': return { x: 50 - radius * 0.707, y: 50 - radius * 0.707 };
                default: return { x: 50, y: 50 };
            }
        }

        function getTooltipPosition(tooltipPos) {
            switch(tooltipPos) {
                case 'top': return { top: '-40px', left: '50%', transform: 'translateX(-50%)' };
                case 'top-right': return { top: '-40px', left: '20px' };
                case 'top-left': return { top: '-40px', right: '20px' };
                case 'bottom': return { bottom: '-40px', left: '50%', transform: 'translateX(-50%)' };
                case 'bottom-right': return { bottom: '-40px', left: '20px' };
                case 'bottom-left': return { bottom: '-40px', right: '20px' };
                case 'left': return { top: '50%', right: '30px', transform: 'translateY(-50%)' };
                case 'right': return { top: '50%', left: '30px', transform: 'translateY(-50%)' };
                default: return { top: '-40px', left: '50%', transform: 'translateX(-50%)' };
            }
        }

        // ==================== äº¤äº’åŠŸèƒ½å‡½æ•° ====================
        function showPuzzle(title, description, buttons) {
            closePuzzle(); // å…ˆå…³é—­å¯èƒ½å­˜åœ¨çš„å…¶ä»–è°œé¢˜
            const puzzleHTML = `
                <div class="puzzle-interface">
                    <div class="puzzle-title">${title}</div>
                    <div>${description}</div>
                    <div class="puzzle-controls">
                        ${buttons.map(btn => 
                            `<button class="puzzle-button" onclick="(${btn.action.toString()})()">${btn.text}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
            document.getElementById('closeup-view').insertAdjacentHTML('beforeend', puzzleHTML);
        }

        function closePuzzle() {
            const puzzles = document.querySelectorAll('.puzzle-interface');
            puzzles.forEach(puzzle => puzzle.remove());
        }

        function showMessage(title, message) {
            alert(`${title}\n\n${message}`);
        }

        function showDoorPuzzle() {
            showPuzzle('ä¸ƒé‡é”é’¥', 'é—¨ä¸Šæœ‰ä¸ƒä¸ªé”å­”ï¼Œæ¯ä¸ªéƒ½å¯¹åº”ç€ä¸åŒçš„ç½ªå­½ç¬¦å·ã€‚ä½ éœ€è¦æ‰¾åˆ°æ­£ç¡®çš„å¼€å¯é¡ºåºã€‚', [
                { text: 'æ£€æŸ¥é”å­”', action: () => showMessage('é”å­”æ£€æŸ¥', 'ä¸ƒä¸ªé”å­”æ’åˆ—æˆå¥‡ç‰¹çš„å›¾æ¡ˆï¼šå‚²æ…¢ã€å«‰å¦’ã€æ„¤æ€’ã€æ‡’æƒ°ã€è´ªå©ªã€æš´é£Ÿã€è‰²æ¬²ã€‚') },
                { text: 'å°è¯•å¼€é”', action: () => showMessage('å¼€é”å°è¯•', 'ä½ éœ€è¦å…ˆåœ¨å…¶ä»–åœ°æ–¹æ‰¾åˆ°å¼€é”çš„çº¿ç´¢ã€‚') },
                { text: 'æ”¾å¼ƒ', action: () => closePuzzle() }
            ]);
        }

        // ==================== ä¸»è¦æ¸¸æˆå‡½æ•° ====================
        function initGame() {
            const hallView = document.getElementById('hall-view');
            const closeupView = document.getElementById('closeup-view');
            const returnButton = document.getElementById('return-button');

            hallView.style.backgroundImage = `url('${IMAGES.HALL}')`;

            walls.forEach(wall => {
                const dot = document.createElement('div');
                dot.className = 'interaction-dot';
                dot.dataset.wallId = wall.id;
                
                const pos = getPosition(wall.position);
                dot.style.left = `${pos.x}%`;
                dot.style.top = `${pos.y}%`;

                const tooltip = document.createElement('div');
                tooltip.className = 'dot-tooltip';
                tooltip.textContent = wall.name;
                
                const tooltipPos = getTooltipPosition(wall.tooltipPos);
                Object.keys(tooltipPos).forEach(key => {
                    tooltip.style[key] = tooltipPos[key];
                });

                dot.appendChild(tooltip);

                dot.addEventListener('click', (event) => {
                    event.stopPropagation();
                    if (wall.isStart) {
                        dot.style.display = 'none';
                        document.querySelectorAll('.interaction-dot:not([data-wall-id="start"])').forEach(otherDot => {
                            otherDot.style.display = 'block';
                        });
                    } else {
                        showCloseup(wall);
                    }
                });

                if (!wall.isStart) {
                    dot.style.display = 'none';
                }

                hallView.appendChild(dot);
            });

            returnButton.addEventListener('click', () => {
                closeupView.classList.remove('active');
                closeupView.style.backgroundImage = ''; // æ¸…é™¤èƒŒæ™¯å›¾
                setTimeout(() => {
                    hallView.style.opacity = 1;
                }, 500);
            });

            setTimeout(() => {
                hallView.style.opacity = 1;
            }, 6000);
        }

        function showCloseup(wall) {
            const hallView = document.getElementById('hall-view');
            const closeupView = document.getElementById('closeup-view');
            
            hallView.style.opacity = 0;
            
            // æ¸…ç©ºä¹‹å‰çš„äº¤äº’å…ƒç´ å’ŒèƒŒæ™¯
            closeupView.innerHTML = '<button id="return-button">â† è¿”å›å¤§å…</button>';
            closeupView.style.backgroundImage = '';
            
            // è·å–è¯¥é¡µé¢çš„äº¤äº’é…ç½®
            const pageConfig = PAGE_INTERACTIONS[wall.id];
            
            if (pageConfig && pageConfig.background) {
                // è®¾ç½®èƒŒæ™¯å›¾ç‰‡
                closeupView.style.backgroundImage = `url('${pageConfig.background}')`;
                
                // æ·»åŠ äº¤äº’å…ƒç´ 
                if (pageConfig.interactions) {
                    pageConfig.interactions.forEach(interaction => {
                        if (interaction.element) {
                            closeupView.insertAdjacentHTML('beforeend', interaction.element);
                        }
                        
                        // ä¸ºäº¤äº’å…ƒç´ ç»‘å®šäº‹ä»¶
                        if (interaction.type === 'clickable') {
                            const elements = closeupView.querySelectorAll('.interactive-element');
                            const lastElement = elements[elements.length - 1];
                            if (lastElement) {
                                lastElement.addEventListener('click', interaction.action);
                            }
                        } else if (interaction.type === 'puzzle') {
                            // ç«‹å³æ‰§è¡Œè°œé¢˜åŠŸèƒ½
                            setTimeout(() => interaction.action(), 100);
                        }
                    });
                }
            } else {
                // é»˜è®¤æ˜¾ç¤º - ç°åœ¨æ¯ä¸ªé¡µé¢éƒ½ä¼šæ˜¾ç¤ºè‡ªå·±çš„åå­—
                closeupView.innerHTML += `
                    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center;">
                        <h2>${wall.name}</h2>
                        <p>${wall.hint}</p>
                        <p style="margin-top: 20px; font-style: italic; color: #a08c6c;">
                            ã€${wall.name} é¡µé¢ã€‘<br>
                            ï¼ˆç­‰å¾…æ·»åŠ ç‰¹å†™å›¾ç‰‡å’Œäº’åŠ¨å†…å®¹ï¼‰
                        </p>
                    </div>
                `;
            }

            // é‡æ–°ç»‘å®šè¿”å›æŒ‰é’®äº‹ä»¶
            document.getElementById('return-button').addEventListener('click', () => {
                closeupView.classList.remove('active');
                closeupView.style.backgroundImage = '';
                setTimeout(() => {
                    hallView.style.opacity = 1;
                }, 500);
            });

            setTimeout(() => {
                closeupView.classList.add('active');
            }, 500);
        }

        window.addEventListener('load', initGame);
        // ==================== å¤§é—¨é¡µé¢æ•°æ®é…ç½® ====================
const DOOR_CONFIG = {
    // ä¸ƒå®—ç½ªç¬¦å·é…ç½®
    sins: [
        { id: 'pride', symbol: 'ğŸ¦', name: 'å‚²æ…¢', latin: 'Superbia' },
        { id: 'envy', symbol: 'ğŸ¦‹', name: 'å«‰å¦’', latin: 'Invidia' },
        { id: 'wrath', symbol: 'ğŸ‚', name: 'æ„¤æ€’', latin: 'Ira' },
        { id: 'sloth', symbol: 'ğŸ¦¥', name: 'æ‡’æƒ°', latin: 'Acedia' },
        { id: 'greed', symbol: 'ğŸ¦Š', name: 'è´ªå©ª', latin: 'Avaritia' },
        { id: 'gluttony', symbol: 'ğŸ—', name: 'æš´é£Ÿ', latin: 'Gula' },
        { id: 'lust', symbol: 'ğŸ¦‚', name: 'è‰²æ¬²', latin: 'Luxuria' }
    ],
    // æ­£ç¡®çš„å¼€å¯é¡ºåºï¼ˆé€†å¡å·´æ‹‰é¡ºåºï¼‰
    correctOrder: ['gluttony', 'lust', 'greed', 'sloth', 'wrath', 'envy', 'pride'],
    // æç¤ºä¿¡æ¯
    hints: [
        "æç¤ºï¼šé¡ºåºä¸ç‰©è´¨çš„å •è½æœ‰å…³",
        "æç¤ºï¼šæƒ³æƒ³ä»€ä¹ˆæ˜¯'é€†å¡å·´æ‹‰'", 
        "æç¤ºï¼šä»æœ€åŸºç¡€çš„æ¬²æœ›å¼€å§‹",
        "æç¤ºï¼šæš´é£Ÿ â†’ è‰²æ¬² â†’ è´ªå©ª â†’ æ‡’æƒ° â†’ æ„¤æ€’ â†’ å«‰å¦’ â†’ å‚²æ…¢"
    ]
};

// ==================== å¤§é—¨é¡µé¢æ¸¸æˆçŠ¶æ€ ====================
let doorGameState = {
    currentSequence: [],
    availableSins: [...DOOR_CONFIG.sins],
    hintsUsed: 0,
    attempts: 0
};

// ==================== å¤§é—¨é¡µé¢äº¤äº’å‡½æ•° ====================
function showDoorPuzzle() {
    const doorHTML = `
        <div class="door-interface">
            <div class="door-title">ä¸ƒé‡é”é’¥</div>
            <div class="door-subtitle">"Sicut Superius, Inferius"<br>å¦‚å…¶åœ¨ä¸Šï¼Œå¦‚å…¶åœ¨ä¸‹</div>
            
            <div class="locks-container" id="locks-container">
                ${Array(7).fill(0).map((_, index) => `
                    <div class="lock-slot" data-slot-index="${index}" onclick="placeSymbol(${index})">
                        ${doorGameState.currentSequence[index] ? 
                            DOOR_CONFIG.sins.find(sin => sin.id === doorGameState.currentSequence[index]).symbol : 
                            '?'
                        }
                    </div>
                `).join('')}
            </div>

            <div class="symbols-container" id="symbols-container">
                ${doorGameState.availableSins.map(sin => `
                    <div class="sin-symbol" draggable="true" data-sin-id="${sin.id}"
                         onclick="selectSymbol('${sin.id}')"
                         title="${sin.name} - ${sin.latin}">
                        ${sin.symbol}
                    </div>
                `).join('')}
            </div>

            <div class="controls-container">
                <button class="door-button" onclick="checkSequence()" 
                        ${doorGameState.currentSequence.length !== 7 ? 'disabled' : ''}>
                    å°è¯•å¼€é”
                </button>
                <button class="door-button" onclick="resetSequence()">é‡ç½®é¡ºåº</button>
                <button class="door-button" onclick="showHint()">
                    æç¤º (${3 - doorGameState.hintsUsed}æ¬¡å‰©ä½™)
                </button>
            </div>

            <div id="message-area"></div>
            <div class="hint-text">å°è¯•æ¬¡æ•°: ${doorGameState.attempts}</div>
        </div>
    `;

    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', doorHTML);
    setupDragAndDrop();
}

function setupDragAndDrop() {
    const symbols = document.querySelectorAll('.sin-symbol');
    const slots = document.querySelectorAll('.lock-slot');

    symbols.forEach(symbol => {
        symbol.addEventListener('dragstart', handleDragStart);
        symbol.addEventListener('dragend', handleDragEnd);
    });

    slots.forEach(slot => {
        slot.addEventListener('dragover', handleDragOver);
        slot.addEventListener('drop', handleDrop);
    });
}

function handleDragStart(e) {
    e.dataTransfer.setData('text/plain', e.target.dataset.sinId);
    e.target.classList.add('dragging');
}

function handleDragEnd(e) {
    e.target.classList.remove('dragging');
}

function handleDragOver(e) {
    e.preventDefault();
}

function handleDrop(e) {
    e.preventDefault();
    const sinId = e.dataTransfer.getData('text/plain');
    const slotIndex = parseInt(e.target.dataset.slotIndex);
    placeSymbolInSlot(sinId, slotIndex);
}

function selectSymbol(sinId) {
    const firstEmptySlot = document.querySelector('.lock-slot:not(.filled)');
    if (firstEmptySlot) {
        const slotIndex = parseInt(firstEmptySlot.dataset.slotIndex);
        placeSymbolInSlot(sinId, slotIndex);
    }
}

function placeSymbol(slotIndex) {
    if (doorGameState.currentSequence[slotIndex]) {
        removeSymbolFromSlot(slotIndex);
    }
}

function placeSymbolInSlot(sinId, slotIndex) {
    if (doorGameState.currentSequence[slotIndex]) {
        removeSymbolFromSlot(slotIndex);
    }

    doorGameState.currentSequence[slotIndex] = sinId;
    const sin = DOOR_CONFIG.sins.find(s => s.id === sinId);
    
    const slot = document.querySelector(`[data-slot-index="${slotIndex}"]`);
    slot.innerHTML = sin.symbol;
    slot.classList.add('filled');
    slot.title = `${sin.name} - ${sin.latin}`;

    const symbolElement = document.querySelector(`[data-sin-id="${sinId}"]`);
    if (symbolElement) {
        symbolElement.classList.add('used');
        symbolElement.style.cursor = 'not-allowed';
        symbolElement.draggable = false;
    }

    const checkButton = document.querySelector('.door-button');
    if (doorGameState.currentSequence.filter(Boolean).length === 7) {
        checkButton.disabled = false;
    }
}

function removeSymbolFromSlot(slotIndex) {
    const sinId = doorGameState.currentSequence[slotIndex];
    if (sinId) {
        const symbolElement = document.querySelector(`[data-sin-id="${sinId}"]`);
        if (symbolElement) {
            symbolElement.classList.remove('used');
            symbolElement.style.cursor = 'grab';
            symbolElement.draggable = true;
        }

        doorGameState.currentSequence[slotIndex] = null;
        const slot = document.querySelector(`[data-slot-index="${slotIndex}"]`);
        slot.innerHTML = '?';
        slot.classList.remove('filled');
        slot.title = '';

        const checkButton = document.querySelector('.door-button');
        checkButton.disabled = true;
    }
}

function checkSequence() {
    doorGameState.attempts++;
    const currentSequence = doorGameState.currentSequence.filter(Boolean);
    
    if (currentSequence.length !== 7) {
        showMessage('è¯·å¡«æ»¡æ‰€æœ‰ä¸ƒä¸ªé”å­”', 'error');
        return;
    }

    const isCorrect = currentSequence.every((sinId, index) => 
        sinId === DOOR_CONFIG.correctOrder[index]
    );

    if (isCorrect) {
        showMessage('æˆåŠŸäº†ï¼å¤§é—¨ç¼“ç¼“æ‰“å¼€...', 'success');
        setTimeout(() => {
            showMessage('é—¨åæ˜¯ä¸€æ¡é€šå¾€æœªçŸ¥çš„é€šé“...', 'success');
        }, 2000);
    } else {
        showMessage('é”å­”å‘å‡ºæ²‰é‡çš„å“å£°ï¼Œä½†é—¨æ²¡æœ‰æ‰“å¼€ã€‚é¡ºåºä¼¼ä¹ä¸å¯¹...', 'error');
        const correctPositions = currentSequence.filter((sinId, index) => 
            sinId === DOOR_CONFIG.correctOrder[index]
        ).length;
        showMessage(`æœ‰ ${correctPositions} ä¸ªç¬¦å·åœ¨æ­£ç¡®çš„ä½ç½®ä¸Š`, 'error');
    }

    updateAttemptsDisplay();
}

function resetSequence() {
    doorGameState.currentSequence = [];
    doorGameState.availableSins = [...DOOR_CONFIG.sins];
    
    const slots = document.querySelectorAll('.lock-slot');
    slots.forEach(slot => {
        slot.innerHTML = '?';
        slot.classList.remove('filled');
        slot.title = '';
    });

    const symbols = document.querySelectorAll('.sin-symbol');
    symbols.forEach(symbol => {
        symbol.classList.remove('used');
        symbol.style.cursor = 'grab';
        symbol.draggable = true;
    });

    const checkButton = document.querySelector('.door-button');
    checkButton.disabled = true;

    showMessage('é¡ºåºå·²é‡ç½®', 'error');
}

function showHint() {
    if (doorGameState.hintsUsed >= 3) {
        showMessage('æ²¡æœ‰æ›´å¤šæç¤ºäº†', 'error');
        return;
    }

    doorGameState.hintsUsed++;
    const hint = DOOR_CONFIG.hints[doorGameState.hintsUsed - 1];
    showMessage(hint, 'error');
    
    const hintButton = document.querySelector('.door-button:last-child');
    hintButton.textContent = `æç¤º (${3 - doorGameState.hintsUsed}æ¬¡å‰©ä½™)`;
    
    if (doorGameState.hintsUsed >= 3) {
        hintButton.disabled = true;
    }
}

function showMessage(message, type) {
    const messageArea = document.getElementById('message-area');
    messageArea.innerHTML = `<div class="${type}-message">${message}</div>`;
    
    if (type === 'success') {
        messageArea.classList.add('success-message');
        messageArea.classList.remove('error-message');
    } else {
        messageArea.classList.add('error-message');
        messageArea.classList.remove('success-message');
    }
}

function updateAttemptsDisplay() {
    const attemptsDisplay = document.querySelector('.hint-text');
    if (attemptsDisplay) {
        attemptsDisplay.textContent = `å°è¯•æ¬¡æ•°: ${doorGameState.attempts}`;
    }
}
        // ==================== æ²¹ç”»é¡µé¢ ====================
function showPaintingPuzzle() {
    const paintingHTML = `
        <div class="door-interface">
            <div class="door-title">ç¥ç§˜çš„å¤å…¸æ²¹ç”»</div>
            <div class="door-subtitle">"å®¶æ—å‘ç°åœ£æ°´çš„ç¥åœ£æ—¶åˆ»"</div>
            
            <div class="painting-container">
                <div class="painting-area" id="painting-area">
                    <div class="painting-hotspot" style="top: 30%; left: 40%;" onclick="examineEyes()">
                        ğŸ‘ï¸ äººç‰©çš„çœ¼ç¥
                    </div>
                    <div class="painting-hotspot" style="top: 60%; left: 25%;" onclick="examineBottle()">
                        ğŸ¶ åœ£æ°´ç“¶
                    </div>
                    <div class="painting-hotspot" style="top: 70%; left: 65%;" onclick="examineBackground()">
                        ğŸï¸ èƒŒæ™¯ç¬¦å·
                    </div>
                    <div class="painting-hotspot" style="top: 45%; left: 75%;" onclick="examineFrame()">
                        ğŸ–¼ï¸ ç”»æ¡†åˆ»æ–‡
                    </div>
                </div>
            </div>

            <div class="controls-container">
                <button class="door-button" onclick="useUltraviolet()">ä½¿ç”¨ç´«å¤–ç¯</button>
                <button class="door-button" onclick="cleanPainting()">æ¸…ç†ç”»é¢</button>
                <button class="door-button" onclick="checkReflection()">æ£€æŸ¥åå…‰</button>
            </div>

            <div id="painting-message" class="hint-text"></div>
            <div class="hint-text">å·²å‘ç°çº¿ç´¢: <span id="clue-count">0</span>/4</div>
        </div>
    `;
    
    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', paintingHTML);
    resetPaintingState();
}

// æ²¹ç”»é¡µé¢çŠ¶æ€
let paintingState = {
    cluesFound: 0,
    uvUsed: false,
    cleaned: false
};

function resetPaintingState() {
    paintingState = {
        cluesFound: 0,
        uvUsed: false,
        cleaned: false
    };
    updateClueCount();
}

function updateClueCount() {
    const countElement = document.getElementById('clue-count');
    if (countElement) {
        countElement.textContent = paintingState.cluesFound;
    }
}

function showPaintingMessage(message, type = 'info') {
    const messageElement = document.getElementById('painting-message');
    if (messageElement) {
        const color = type === 'success' ? '#6b8e23' : type === 'error' ? '#8b4513' : '#e0d3b8';
        messageElement.innerHTML = `<div style="color: ${color}; margin: 10px 0;">${message}</div>`;
    }
}

// æ£€æŸ¥äººç‰©çœ¼ç¥
function examineEyes() {
    if (!paintingState.cleaned) {
        showPaintingMessage('ç”»é¢å¤ªè„äº†ï¼Œçœ‹ä¸æ¸…äººç‰©çš„çœ¼ç¥ç»†èŠ‚ã€‚ä¹Ÿè®¸éœ€è¦å…ˆæ¸…ç†ä¸€ä¸‹ï¼Ÿ', 'error');
        return;
    }
    
    showPaintingMessage('ä½ å‘ç°ç”»ä¸­äººç‰©çš„çœ¼ç¥å¼‚å¸¸ç©ºæ´ï¼Œç³å­”ä¸­ä¼¼ä¹åå°„ç€æŸç§å‡ ä½•å›¾æ¡ˆ...', 'success');
    addClue();
}

// æ£€æŸ¥åœ£æ°´ç“¶
function examineBottle() {
    showPaintingMessage('åœ£æ°´ç“¶ä¸­æµåŠ¨ç€å¹½ç»¿è‰²çš„æ¶²ä½“ï¼Œç“¶èº«ä¸Šåˆ»ç€:"EX INFERNO AD CAELUM"ï¼ˆä»åœ°ç‹±åˆ°å¤©å ‚ï¼‰', 'success');
    addClue();
}

// æ£€æŸ¥èƒŒæ™¯ç¬¦å·
function examineBackground() {
    if (!paintingState.uvUsed) {
        showPaintingMessage('èƒŒæ™¯çœ‹èµ·æ¥åªæ˜¯æ™®é€šçš„é£æ™¯ï¼Œä½†æ€»è§‰å¾—æœ‰äº›ä¸å¯¹åŠ²...', 'error');
        return;
    }
    
    showPaintingMessage('åœ¨ç´«å¤–çº¿ä¸‹ï¼ŒèƒŒæ™¯æ˜¾ç°å‡ºéšè—çš„ç¬¦å·ï¼šä¸€ä¸ªè¢«å…­èŠ’æ˜ŸåŒ…å›´çš„é»‘æ´å›¾æ¡ˆï¼', 'success');
    addClue();
}

// æ£€æŸ¥ç”»æ¡†åˆ»æ–‡
function examineFrame() {
    showPaintingMessage('ç”»æ¡†å†…ä¾§åˆ»ç€ç»†å°çš„æ–‡å­—ï¼š"ä»–èµäºˆç”Ÿå‘½ï¼Œå´ç´¢å–çµé­‚ã€‚éæ©èµï¼Œå®ä¸ºå€Ÿè´·ã€‚"', 'success');
    addClue();
}

// ä½¿ç”¨ç´«å¤–ç¯
function useUltraviolet() {
    paintingState.uvUsed = true;
    const paintingArea = document.getElementById('painting-area');
    if (paintingArea) {
        paintingArea.style.border = '3px solid #9400d3';
        paintingArea.style.background = 'linear-gradient(45deg, #2a1f1a, #4b0082)';
    }
    showPaintingMessage('ç´«å¤–ç¯ä¸‹ï¼Œç”»é¢æ˜¾ç°å‡ºéšè—çš„ç»†èŠ‚ï¼å¿«å»æ£€æŸ¥èƒŒæ™¯ï¼', 'success');
}

// æ¸…ç†ç”»é¢
function cleanPainting() {
    paintingState.cleaned = true;
    const paintingArea = document.getElementById('painting-area');
    if (paintingArea) {
        paintingArea.style.background = 'rgba(139, 69, 19, 0.1)';
    }
    showPaintingMessage('æ¸…ç†åï¼Œç”»é¢çš„ç»†èŠ‚æ›´åŠ æ¸…æ™°äº†ï¼ç°åœ¨å¯ä»¥æ£€æŸ¥äººç‰©çœ¼ç¥äº†ã€‚', 'success');
}

// æ£€æŸ¥åå…‰
function checkReflection() {
    if (paintingState.cluesFound >= 3) {
        showPaintingMessage('åœ¨ç‰¹å®šè§’åº¦ä¸‹ï¼Œä½ å‘ç°æ²¹ç”»è¡¨é¢åå°„å‡ºä¹¦æˆ¿ä¸­å…¶ä»–ç‰©ä½“çš„å½±åƒï¼Œä¼¼ä¹æš—ç¤ºç€æŸç§è”ç³»...', 'success');
        if (paintingState.cluesFound === 3) {
            addClue(); // ç¬¬å››ä¸ªçº¿ç´¢
        }
    } else {
        showPaintingMessage('éœ€è¦å‘ç°æ›´å¤šçº¿ç´¢æ‰èƒ½çœ‹å‡ºå…¶ä¸­çš„è§„å¾‹...', 'error');
    }
}

function addClue() {
    if (paintingState.cluesFound < 4) {
        paintingState.cluesFound++;
        updateClueCount();
        
        if (paintingState.cluesFound === 4) {
            showPaintingMessage('ğŸ‰ ä½ å‘ç°äº†æ²¹ç”»çš„æ‰€æœ‰ç§˜å¯†ï¼ç”»ä¸­éšè—çš„çœŸç›¸ä»¤äººä¸å®‰...', 'success');
            setTimeout(() => {
                showPaintingMessage('"æˆ‘ä»¬å´‡æ‹œçš„å¹¶éç¥æ˜ï¼Œè€Œæ˜¯å›šç¦æˆ‘ä»¬çš„ç‹±å’ã€‚"', 'success');
            }, 3000);
        }
    }
}
        // ==================== ä¹¦æ¡Œé¡µé¢ ====================
function showDeskPuzzle() {
    const deskHTML = `
        <div class="door-interface">
            <div class="door-title">å®¶ä¸»çš„ä¹¦æ¡Œ</div>
            <div class="door-subtitle">ç²¾è‡´çš„æ¡ƒèŠ±å¿ƒæœ¨ä¹¦æ¡Œï¼Œä¸Šé¢æ•£è½ç€æ–‡ä»¶å’Œæ¡£æ¡ˆ</div>
            
            <div class="locks-container">
                <div class="lock-slot" onclick="examineDrawer()" style="cursor:pointer;">
                    ğŸ“<br>æŠ½å±‰
                </div>
                <div class="lock-slot" onclick="readDiary()" style="cursor:pointer;">
                    ğŸ“–<br>æ—¥è®°
                </div>
                <div class="lock-slot" onclick="checkAccounts()" style="cursor:pointer;">
                    ğŸ’°<br>è´¦æœ¬
                </div>
                <div class="lock-slot" onclick="examineLetters()" style="cursor:pointer;">
                    âœ‰ï¸<br>ä¿¡ä»¶
                </div>
            </div>

            <div class="symbols-container">
                <div class="sin-symbol" onclick="examineInkwell()" style="cursor:pointer;" title="å¢¨æ°´ç“¶">
                    ğŸ–‹ï¸
                </div>
                <div class="sin-symbol" onclick="checkPhoto()" style="cursor:pointer;" title="ç…§ç‰‡">
                    ğŸ–¼ï¸
                </div>
                <div class="sin-symbol" onclick="searchHidden()" style="cursor:pointer;" title="éšè—éš”å±‚">
                    ğŸ”
                </div>
            </div>

            <div class="controls-container">
                <button class="door-button" onclick="tryOpenSecret()">å°è¯•æ‰“å¼€ç§˜å¯†éš”å±‚</button>
                <button class="door-button" onclick="decipherCode()">ç ´è¯‘å¯†ç </button>
            </div>

            <div id="desk-message-area"></div>
            <div class="hint-text">æç¤ºï¼šä»”ç»†æ£€æŸ¥æ‰€æœ‰ç‰©å“ï¼Œå¯»æ‰¾çº¿ç´¢</div>
        </div>
    `;
    
    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', deskHTML);
}

// æŠ½å±‰åŠŸèƒ½
function examineDrawer() {
    const messages = [
        "æŠ½å±‰é‡Œæœ‰ä¸€äº›æ—§é’¥åŒ™å’Œå°ç« ",
        "ä½ å‘ç°äº†ä¸€æŠŠç‰¹æ®Šçš„é»„é“œé’¥åŒ™ï¼Œä¸Šé¢åˆ»ç€'VII'",
        "æŠ½å±‰åº•éƒ¨æœ‰ä¸€äº›æ³›é»„çš„åœ°å›¾è‰å›¾",
        "è¿™é‡Œæœ‰ä¸€å°è¢«æ’•ç¢ååˆç²˜åˆçš„ä¿¡ä»¶"
    ];
    showDeskMessage(messages[Math.floor(Math.random() * messages.length)], "success");
}

// æ—¥è®°åŠŸèƒ½
function readDiary() {
    const entries = [
        "'3æœˆ15æ—¥ï¼šæ³‰æ°´å¸¦æ¥çš„è´¢å¯Œè¶…ä¹æƒ³è±¡ï¼Œä½†ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ'",
        "'4æœˆ2æ—¥ï¼šä¼Šæ¡‘é‚£å­©å­åˆè¯´äº›ç–¯è¯ï¼Œå¿…é¡»æŠŠä»–é€èµ°'", 
        "'5æœˆ18æ—¥ï¼šæ™šä¸Šçš„ä½è¯­å£°è¶Šæ¥è¶Šæ¸…æ™°äº†...'",
        "'6æœˆ30æ—¥ï¼šæˆ‘ä»¬éƒ½è¢«å›°åœ¨è¿™é‡Œäº†ï¼Œå°±åƒç¥­å›ä¸Šçš„è´¡å“'"
    ];
    showDeskMessage(`æ—¥è®°æ‘˜å½•ï¼š${entries[Math.floor(Math.random() * entries.length)]}`, "success");
}

// è´¦æœ¬åŠŸèƒ½  
function checkAccounts() {
    showDeskMessage("è´¦æœ¬æ˜¾ç¤ºå¤§é‡èµ„é‡‘æµå‘ä¸€ä¸ªåä¸º'æ°¸æ’ä¹‹çœ¼'çš„è´¦æˆ·ï¼Œç”¨é€”ä¸æ˜", "error");
}

// ä¿¡ä»¶åŠŸèƒ½
function examineLetters() {
    showDeskMessage("ä¿¡ä»¶ä¸­æåˆ°'é€†å¡å·´æ‹‰çš„ç§˜å¯†'å’Œ'ä¸ƒé‡è¯•ç‚¼'ï¼Œä¼¼ä¹ä¸å¤§é—¨æœ‰å…³", "success");
}

// å¢¨æ°´ç“¶
function examineInkwell() {
    showDeskMessage("å¢¨æ°´ç“¶åº•éƒ¨åˆ»ç€å¾®å°çš„æ–‡å­—ï¼š'çœŸç†è—äºé˜´å½±ä¹‹ä¸­'", "success");
}

// ç…§ç‰‡
function checkPhoto() {
    showDeskMessage("å…¨å®¶ç¦ç…§ç‰‡ä¸­ï¼ŒæŸäº›å®¶åº­æˆå‘˜çš„çœ¼ç›è¢«åˆ»æ„æ¶‚é»‘", "error");
}

// éšè—éš”å±‚
function searchHidden() {
    showDeskMessage("ä½ å‘ç°äº†ä¸€ä¸ªéšè—éš”å±‚ï¼ä½†éœ€è¦å¯†ç æ‰èƒ½æ‰“å¼€", "success");
}

// å°è¯•æ‰“å¼€ç§˜å¯†éš”å±‚
function tryOpenSecret() {
    showDeskMessage("éš”å±‚çº¹ä¸ä¸åŠ¨ã€‚ä½ éœ€è¦æ‰¾åˆ°æ­£ç¡®çš„å¼€å¯æ–¹æ³•", "error");
}

// ç ´è¯‘å¯†ç 
function decipherCode() {
    showDeskMessage("è¿™äº›ç¬¦å·ä¼¼ä¹ä¸ä¸ƒå®—ç½ªçš„é¡ºåºæœ‰å…³...", "success");
}

// æ˜¾ç¤ºæ¶ˆæ¯çš„è¾…åŠ©å‡½æ•°
function showDeskMessage(message, type) {
    const messageArea = document.getElementById('desk-message-area');
    if (type === 'success') {
        messageArea.innerHTML = `<div class="success-message">${message}</div>`;
    } else {
        messageArea.innerHTML = `<div class="error-message">${message}</div>`;
    }
}
        // ==================== åœ°å›¾é¡µé¢ ====================
function showMapPuzzle() {
    const mapHTML = `
        <div class="door-interface" style="max-width: 800px;">
            <div class="door-title">ä¸–ç•Œåœ°å›¾</div>
            <div class="door-subtitle">"æˆ‘ä»¬å³æ˜¯ä¸–ç•Œçš„ä¸­å¿ƒ" - é»‘æ°´å®¶æ—æ ¼è¨€</div>
            
            <!-- åœ°å›¾å¯è§†åŒ– -->
            <div style="position: relative; margin: 20px auto; width: 300px; height: 200px; background: linear-gradient(135deg, #1e3c72, #2a5298); border: 3px solid #8b4513; border-radius: 10px;">
                <!-- åº„å›­ä½ç½® -->
                <div class="map-point" style="top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #d4af37;" 
                     onclick="inspectManor()" title="é»‘æ°´åº„å›­">
                    â˜…
                </div>
                
                <!-- å…­ä¸ªæ ‡è®°ç‚¹ -->
                <div class="map-point" style="top: 20%; left: 70%;" onclick="inspectPoint('æ¬§æ´²')" title="æ¬§æ´²">â… </div>
                <div class="map-point" style="top: 40%; left: 85%;" onclick="inspectPoint('äºšæ´²')" title="äºšæ´²">â…¡</div>
                <div class="map-point" style="top: 70%; left: 80%;" onclick="inspectPoint('å¤§æ´‹æ´²')" title="å¤§æ´‹æ´²">â…¢</div>
                <div class="map-point" style="top: 80%; left: 40%;" onclick="inspectPoint('å—ç¾æ´²')" title="å—ç¾æ´²">â…£</div>
                <div class="map-point" style="top: 40%; left: 15%;" onclick="inspectPoint('åŒ—ç¾æ´²')" title="åŒ—ç¾æ´²">â…¤</div>
                <div class="map-point" style="top: 20%; left: 30%;" onclick="inspectPoint('éæ´²')" title="éæ´²">â…¥</div>
            </div>

            <div class="controls-container">
                <button class="door-button" onclick="measureDistances()">æµ‹é‡è·ç¦»</button>
                <button class="door-button" onclick="checkProjection()">æ£€æŸ¥æŠ•å½±</button>
                <button class="door-button" onclick="findAnomalies()">å¯»æ‰¾å¼‚å¸¸</button>
            </div>

            <div id="map-message" style="min-height: 60px; margin-top: 20px;"></div>
            
            <div class="hint-text">ç‚¹å‡»åœ°å›¾ä¸Šçš„æ ‡è®°ç‚¹è¿›è¡Œæ¢ç´¢</div>
        </div>
    `;
    
    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', mapHTML);
}

// åœ°å›¾ç‚¹æ ·å¼ï¼ˆæ·»åŠ åˆ°CSSä¸­ï¼‰
const mapStyle = `
    .map-point {
        position: absolute;
        width: 30px;
        height: 30px;
        background-color: rgba(139, 69, 19, 0.8);
        border: 2px solid #e0d3b8;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        color: #e0d3b8;
    }
    .map-point:hover {
        transform: scale(1.2);
        background-color: rgba(160, 82, 45, 0.9);
    }
`;

// æ³¨å…¥CSSæ ·å¼
if (!document.querySelector('#map-styles')) {
    const styleElement = document.createElement('style');
    styleElement.id = 'map-styles';
    styleElement.textContent = mapStyle;
    document.head.appendChild(styleElement);
}

// åœ°å›¾äº¤äº’å‡½æ•°
function inspectManor() {
    const messages = [
        "é»‘æ°´åº„å›­è¢«ç²¾ç¡®æ ‡è®°åœ¨åœ°å›¾çš„æ­£ä¸­å¿ƒ",
        "ç»çº¬åº¦åæ ‡æ˜¾ç¤ºï¼š0Â°N, 0Â°E - è¿™åœ¨åœ°ç†ä¸Šæ˜¯ä¸å¯èƒ½çš„",
        "åº„å›­å‘¨å›´æœ‰å…­ä¸ªç­‰è·çš„æ ‡è®°ç‚¹ï¼Œå½¢æˆå®Œç¾çš„å…­è¾¹å½¢",
        "åœ°å›¾æ¯”ä¾‹ä¸¥é‡å¤±çœŸï¼Œåº„å›­çš„å¤§å°ç›¸å½“äºä¸€ä¸ªå¤§é™†"
    ];
    
    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
    showMapMessage(randomMessage, 'success');
}

function inspectPoint(region) {
    const regionInfo = {
        'æ¬§æ´²': "è¾¹ç•Œæ‰­æ›²ï¼Œè‹±ä¼¦ä¸‰å²›çš„ä½ç½®å®Œå…¨é”™è¯¯",
        'äºšæ´²': "å–œé©¬æ‹‰é›…å±±è„‰çš„é«˜åº¦è¢«å¤¸å¼ äº†åå€",
        'å¤§æ´‹æ´²': "æ¾³å¤§åˆ©äºšçš„å½¢çŠ¶åƒè¢«æŸç§åŠ›é‡æ‹‰æ‰¯",
        'å—ç¾æ´²': "äºšé©¬é€Šæ²³æµåŸŸçš„èµ°å‘ä¸ç¬¦åˆä»»ä½•å·²çŸ¥åœ°å›¾",
        'åŒ—ç¾æ´²': "äº”å¤§æ¹–çš„ä½ç½®å‡ºç°äº†ç¥ç§˜çš„åç§»", 
        'éæ´²': "æ’’å“ˆæ‹‰æ²™æ¼ çš„é¢ç§¯è¢«ä¸¥é‡ç¼©å°"
    };
    
    showMapMessage(`${region}: ${regionInfo[region]}`, 'error');
}

function measureDistances() {
    showMapMessage("æµ‹é‡ç»“æœï¼šä»åº„å›­åˆ°æ‰€æœ‰å…­ä¸ªæ ‡è®°ç‚¹çš„è·ç¦»å®Œå…¨ç›¸ç­‰ - è¿™åœ¨çƒé¢å‡ ä½•ä¸Šä¸å¯èƒ½", 'error');
}

function checkProjection() {
    showMapMessage("åœ°å›¾æŠ•å½±åˆ†æï¼šè¿™ä¸æ˜¯å¢¨å¡æ‰˜æŠ•å½±ï¼Œä¹Ÿä¸æ˜¯ä»»ä½•å·²çŸ¥çš„æŠ•å½±æ–¹å¼ã€‚ç©ºé—´ä¼¼ä¹åœ¨åº„å›­å‘¨å›´å‘ç”Ÿäº†æ‰­æ›²ã€‚", 'error');
}

function findAnomalies() {
    const anomalies = [
        "å‘ç°é‡åŠ›å¼‚å¸¸ï¼šåº„å›­åŒºåŸŸçš„ç­‰é«˜çº¿æ˜¾ç¤ºåé‡åŠ›ç°è±¡",
        "æ—¶é—´å¼‚å¸¸ï¼šæ ¹æ®æ˜Ÿå›¾æ ‡è®°ï¼Œè¿™å¼ åœ°å›¾çš„æ—¶é—´åæ ‡æ˜¯æ··ä¹±çš„", 
        "ç©ºé—´å¼‚å¸¸ï¼šåº„å›­å‘¨å›´çš„åŒºåŸŸæ˜¾ç¤ºå‡ºéæ¬§å‡ é‡Œå¾—å‡ ä½•ç‰¹å¾",
        "å‘ç°éšè—æ ‡è®°ï¼šå…­ä¸ªç‚¹è¿æ¥åå½¢æˆé€†å¡å·´æ‹‰ç¬¦å·"
    ];
    
    const randomAnomaly = anomalies[Math.floor(Math.random() * anomalies.length)];
    showMapMessage(`å¼‚å¸¸å‘ç°ï¼š${randomAnomaly}`, 'success');
}

function showMapMessage(message, type) {
    const messageArea = document.getElementById('map-message');
    const color = type === 'success' ? '#6b8e23' : '#8b4513';
    messageArea.innerHTML = `
        <div style="color: ${color}; font-size: 1.1em; text-align: center; padding: 10px; 
                    background-color: rgba(42, 31, 26, 0.8); border-radius: 5px; border-left: 4px solid ${color};">
            ${message}
        </div>
    `;
}// ==================== å®¶æ—æ ‘é¡µé¢ ====================
function showFamilyTreePuzzle() {
    const familyTreeHTML = `
        <div class="door-interface" style="max-width: 800px;">
            <div class="door-title">é»‘æ°´å®¶æ—è°±ç³»</div>
            <div class="door-subtitle">è¢«è¯…å’’çš„è¡€è„‰ï¼Œè¢«æ©ç›–çš„çœŸç›¸</div>
            
            <!-- å®¶æ—æ ‘å›¾è¡¨ -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 30px 0; padding: 20px; background: rgba(139, 69, 19, 0.1); border-radius: 10px; border: 2px solid #8b4513;">
                <!-- ç¬¬ä¸€ä»£ -->
                <div class="family-member" onclick="examineMember('founder')" style="grid-column: 2; text-align: center; padding: 10px; background: rgba(107, 142, 35, 0.3); border-radius: 5px; cursor: pointer;">
                    <div>ğŸ•´ï¸</div>
                    <div>åŸƒå¾·è’™Â·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1640-1675</div>
                </div>
                
                <!-- ç¬¬äºŒä»£ -->
                <div class="family-member" onclick="examineMember('son1')" style="grid-column: 1; text-align: center; padding: 10px; background: rgba(107, 142, 35, 0.2); border-radius: 5px; cursor: pointer;">
                    <div>ğŸ‘¨</div>
                    <div>å¨å»‰Â·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1660-1690</div>
                </div>
                
                <div class="family-member" onclick="examineMember('son2')" style="grid-column: 3; text-align: center; padding: 10px; background: rgba(107, 142, 35, 0.2); border-radius: 5px; cursor: pointer;">
                    <div>ğŸ‘¨</div>
                    <div>æ‰˜é©¬æ–¯Â·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1662-1720</div>
                </div>
                
                <!-- ç¬¬ä¸‰ä»£ -->
                <div class="family-member" onclick="examineMember('grandson1')" style="grid-column: 1; text-align: center; padding: 10px; background: rgba(107, 142, 35, 0.15); border-radius: 5px; cursor: pointer;">
                    <div>ğŸ§‘</div>
                    <div>äº¨åˆ©Â·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1685-1710</div>
                </div>
                
                <div class="family-member" onclick="examineMember('grandson2')" style="grid-column: 2; text-align: center; padding: 10px; background: rgba(107, 142, 35, 0.15); border-radius: 5px; cursor: pointer;">
                    <div>ğŸ§‘</div>
                    <div>æŸ¥å°”æ–¯Â·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1688-1745</div>
                </div>
                
                <div class="family-member" onclick="examineMember('grandson3')" style="grid-column: 3; text-align: center; padding: 10px; background: rgba(178, 34, 34, 0.3); border-radius: 5px; cursor: pointer; text-decoration: line-through;">
                    <div>ğŸ’€</div>
                    <div>äºšç‘ŸÂ·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1690-1715</div>
                </div>
                
                <!-- ç¬¬å››ä»£ -->
                <div class="family-member" onclick="examineMember('greatgrandson')" style="grid-column: 2; text-align: center; padding: 10px; background: rgba(107, 142, 35, 0.1); border-radius: 5px; cursor: pointer;">
                    <div>ğŸ‘¦</div>
                    <div>çˆ±å¾·åÂ·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1710-1780</div>
                </div>
                
                <!-- ç¬¬äº”ä»£ -->
                <div class="family-member" onclick="examineMember('blind')" style="grid-column: 2; text-align: center; padding: 10px; background: rgba(106, 90, 205, 0.3); border-radius: 5px; cursor: pointer;">
                    <div>ğŸ‘ï¸</div>
                    <div>ä¼Šæ¡‘Â·é»‘æ°´</div>
                    <div style="font-size: 0.8em;">1735-???</div>
                </div>
            </div>
            
            <!-- æ§åˆ¶æŒ‰é’® -->
            <div class="controls-container">
                <button class="door-button" onclick="analyzePattern()">åˆ†ææ­»äº¡æ¨¡å¼</button>
                <button class="door-button" onclick="checkBloodline()">æ£€æŸ¥è¡€è„‰çº¯åº¦</button>
                <button class="door-button" onclick="findSecrets()">å¯»æ‰¾éšè—ä¿¡æ¯</button>
            </div>
            
            <!-- ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="family-message" style="min-height: 60px; margin-top: 20px;"></div>
            
            <div class="hint-text">ç‚¹å‡»å®¶æ—æˆå‘˜æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</div>
        </div>
    `;
    
    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', familyTreeHTML);
}

// æŸ¥çœ‹å®¶æ—æˆå‘˜ä¿¡æ¯
function examineMember(memberId) {
    const messages = {
        'founder': 'å®¶æ—åˆ›å§‹äººåŸƒå¾·è’™Â·é»‘æ°´ã€‚è®°å½•æ˜¾ç¤ºä»–åœ¨35å²æ—¶çªç„¶æš´å¯Œï¼ŒåŒå¹´å»ºç«‹äº†è¿™åº§åº„å›­ã€‚',
        'son1': 'é•¿å­å¨å»‰ï¼Œ30å²æ—¶ç¥ç§˜æ­»äº¡ã€‚å°¸ä½“è¢«å‘ç°æ—¶é¢å®¹å¦‚20å²é’å¹´ã€‚',
        'son2': 'æ¬¡å­æ‰˜é©¬æ–¯ï¼Œæ´»äº†58å²ï¼Œæ˜¯æ—©æœŸå®¶æ—ä¸­æœ€é•¿å¯¿è€…ã€‚ä½†æ™šå¹´é™·å…¥ç–¯ç‹‚ã€‚',
        'grandson1': 'äº¨åˆ©ï¼Œ25å²æ­»äº¡ã€‚æ­»å› è®°å½•ä¸º"æ„å¤–"ï¼Œä½†ç»†èŠ‚è¢«æ¶‚æ”¹ã€‚',
        'grandson2': 'æŸ¥å°”æ–¯ï¼Œ57å²æ­»äº¡ã€‚å¼€å§‹å‡ºç°ä¸¥é‡çš„é—ä¼ ç–¾ç—…ã€‚',
        'grandson3': 'äºšç‘Ÿï¼Œ25å²è¢«ä»æ—è°±ä¸­åˆ’å»ã€‚æ®è¯´ä»–è¯•å›¾æ­éœ²å®¶æ—ç§˜å¯†ã€‚',
        'greatgrandson': 'çˆ±å¾·åï¼Œ70å²æ­»äº¡ã€‚å¼€å§‹å®è¡Œä¸¥æ ¼çš„è¿‘äº²é€šå©šæ”¿ç­–ã€‚',
        'blind': 'ä¼Šæ¡‘ï¼Œç¬¬äº”ä»£ã€‚å¤©ç”Ÿå¤±æ˜ï¼Œä½†æ®è¯´ä»–èƒ½"çœ‹è§"åˆ«äººçœ‹ä¸è§çš„ä¸œè¥¿ã€‚è¢«å®¶æ—æµæ”¾ã€‚'
    };
    
    const messageArea = document.getElementById('family-message');
    messageArea.innerHTML = `<div class="success-message">${messages[memberId]}</div>`;
}

// åˆ†ææ­»äº¡æ¨¡å¼
function analyzePattern() {
    const messageArea = document.getElementById('family-message');
    messageArea.innerHTML = `
        <div class="error-message">
            <strong>æ­»äº¡æ¨¡å¼åˆ†æï¼š</strong><br>
            â€¢ 35%çš„å®¶æ—æˆå‘˜åœ¨25-30å²æ­»äº¡<br>
            â€¢ æ­»äº¡åŸå› å¤§å¤šè®°å½•æ¨¡ç³Š<br>
            â€¢ å°¸ä½“æ™®éä¿æŒå¹´è½»çŠ¶æ€<br>
            â€¢ è¿™ä¸"åœ£æ°´"çš„å‰¯ä½œç”¨æè¿°å»åˆ
        </div>
    `;
}

// æ£€æŸ¥è¡€è„‰çº¯åº¦  
function checkBloodline() {
    const messageArea = document.getElementById('family-message');
    messageArea.innerHTML = `
        <div class="error-message">
            <strong>è¡€è„‰çº¯åº¦æ£€æŸ¥ï¼š</strong><br>
            â€¢ ç¬¬å››ä»£å¼€å§‹å®è¡Œå ‚å…„å¦¹é€šå©š<br>
            â€¢ ç¬¬äº”ä»£å‡ºç°å…ˆå¤©æ€§ç–¾ç—…<br>
            â€¢ è¿‘äº²ç³»æ•°é«˜è¾¾0.25<br>
            â€¢ ä¸ºäº†ä¿æŒ"ç¥åœ£è¡€è„‰"ä¸æƒœä»£ä»·
        </div>
    `;
}

// å¯»æ‰¾éšè—ä¿¡æ¯
function findSecrets() {
    const messageArea = document.getElementById('family-message');
    messageArea.innerHTML = `
        <div class="success-message">
            <strong>éšè—ä¿¡æ¯å‘ç°ï¼š</strong><br>
            ç”¨ç´«å¤–çº¿ç…§å°„æ—è°±ï¼Œå‘ç°ä¼Šæ¡‘ç•™ä¸‹çš„æš—è¯­ï¼š<br>
            <em>"è¡€è„‰éç¥ç¦ï¼Œå®ä¸ºç‰¢ç¬¼ã€‚ä¸ƒä»£ä¹‹å†…ï¼Œå¿…é­åå™¬ã€‚"</em>
        </div>
    `;
}
        // ==================== é­”è¯æ¡Œå­é¡µé¢ ====================
function showPotionPuzzle() {
    const potionHTML = `
        <div class="door-interface">
            <div class="door-title">ç‚¼é‡‘æœ¯å·¥ä½œå°</div>
            <div class="door-subtitle">"ç¿ ç‰ä¹‹ç§˜" - åœ£æ°´çš„ç‚¼åˆ¶</div>
            
            <div style="margin: 20px 0; text-align: left;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div>
                        <h3 style="color: #d4af37; margin-bottom: 10px;">åŸæ–™åŒº</h3>
                        <div class="ingredient" onclick="selectIngredient('æ³‰æ°´')">
                            ğŸ’§ å¤„å¥³åœ°ä¹‹æ³ª (æ³‰æ°´)
                        </div>
                        <div class="ingredient" onclick="selectIngredient('çŸ¿çŸ³')">
                            âšª æœˆå…‰çŸ³ç²‰æœ«
                        </div>
                        <div class="ingredient" onclick="selectIngredient('æ¤ç‰©')">
                            ğŸŒ¿ å¤œå…‰è˜‘è‡
                        </div>
                        <div class="ingredient" onclick="selectIngredient('ç‰¹æ®Š')">
                            ğŸ”¥ åœ°å¿ƒä¹‹ç«ç§
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="color: #d4af37; margin-bottom: 10px;">ç‚¼åˆ¶æ­¥éª¤</h3>
                        <div id="potion-steps">
                            <div class="step">1. é€‰æ‹©åŸºç¡€åŸæ–™</div>
                            <div class="step">2. æ·»åŠ å‚¬åŒ–å‰‚</div>
                            <div class="step">3. æ§åˆ¶ç«å€™</div>
                            <div class="step">4. å®Œæˆç‚¼åˆ¶</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <div id="cauldron" style="border: 2px solid #8b4513; padding: 15px; min-height: 80px; border-radius: 10px; background: rgba(139, 69, 19, 0.2);">
                        <div id="potion-content" style="text-align: center; color: #a08c6c;">
                            å©åŸšç©ºç©ºå¦‚ä¹Ÿ...
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-container">
                <button class="door-button" onclick="startBrewing()" id="brew-btn">å¼€å§‹ç‚¼åˆ¶</button>
                <button class="door-button" onclick="resetPotion()">æ¸…ç©ºå©åŸš</button>
                <button class="door-button" onclick="readFormula()">æŸ¥çœ‹é…æ–¹</button>
            </div>

            <div id="potion-message" style="min-height: 40px; margin-top: 15px;"></div>
            <div class="hint-text" id="potion-hint">æç¤ºï¼šæ­£ç¡®çš„é…æ–¹è®°å½•åœ¨ç‚¼é‡‘æ‰‹ç¨¿ä¸­</div>
        </div>
    `;
    
    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', potionHTML);
}

// é­”è¯ç‚¼åˆ¶çŠ¶æ€
let potionState = {
    ingredients: [],
    step: 0,
    isBrewing: false
};

function selectIngredient(ingredient) {
    if (potionState.isBrewing) {
        showPotionMessage("æ­£åœ¨ç‚¼åˆ¶ä¸­ï¼Œæ— æ³•æ·»åŠ åŸæ–™ï¼", "error");
        return;
    }
    
    if (potionState.ingredients.length >= 3) {
        showPotionMessage("å©åŸšå·²æ»¡ï¼Œæ— æ³•æ·»åŠ æ›´å¤šåŸæ–™ï¼", "error");
        return;
    }
    
    potionState.ingredients.push(ingredient);
    updateCauldron();
    showPotionMessage(`æ·»åŠ äº†ï¼š${ingredient}`, "success");
}

function updateCauldron() {
    const content = document.getElementById('potion-content');
    if (potionState.ingredients.length === 0) {
        content.innerHTML = "å©åŸšç©ºç©ºå¦‚ä¹Ÿ...";
        content.style.color = "#a08c6c";
    } else {
        const ingredientsText = potionState.ingredients.map(ing => {
            switch(ing) {
                case 'æ³‰æ°´': return 'ğŸ’§';
                case 'çŸ¿çŸ³': return 'âšª';
                case 'æ¤ç‰©': return 'ğŸŒ¿';
                case 'ç‰¹æ®Š': return 'ğŸ”¥';
                default: return ing;
            }
        }).join(' + ');
        
        content.innerHTML = `å©åŸšå†…å®¹ï¼š${ingredientsText}`;
        content.style.color = "#e0d3b8";
    }
    
    // æ›´æ–°æ­¥éª¤é«˜äº®
    updateBrewingSteps();
}

function updateBrewingSteps() {
    const steps = document.querySelectorAll('.step');
    steps.forEach((step, index) => {
        if (index === potionState.step) {
            step.style.color = "#d4af37";
            step.style.fontWeight = "bold";
        } else {
            step.style.color = "#e0d3b8";
            step.style.fontWeight = "normal";
        }
    });
}

function startBrewing() {
    if (potionState.ingredients.length === 0) {
        showPotionMessage("å©åŸšæ˜¯ç©ºçš„ï¼è¯·å…ˆæ·»åŠ åŸæ–™ã€‚", "error");
        return;
    }
    
    if (potionState.isBrewing) {
        showPotionMessage("å·²ç»åœ¨ç‚¼åˆ¶ä¸­äº†ï¼", "error");
        return;
    }
    
    potionState.isBrewing = true;
    const brewBtn = document.getElementById('brew-btn');
    brewBtn.disabled = true;
    brewBtn.textContent = "ç‚¼åˆ¶ä¸­...";
    
    showPotionMessage("å¼€å§‹ç‚¼åˆ¶...å©åŸšå¼€å§‹å‘å‡ºå¥‡å¼‚çš„å…‰èŠ’", "success");
    
    // æ¨¡æ‹Ÿç‚¼åˆ¶è¿‡ç¨‹
    setTimeout(() => {
        potionState.step = 1;
        updateBrewingSteps();
        showPotionMessage("åŠ å…¥å‚¬åŒ–å‰‚...æ¶²ä½“å¼€å§‹å˜è‰²", "success");
    }, 1500);
    
    setTimeout(() => {
        potionState.step = 2;
        updateBrewingSteps();
        showPotionMessage("æ§åˆ¶ç«å€™...æ¶²ä½“å¼€å§‹æ²¸è…¾", "success");
    }, 3000);
    
    setTimeout(() => {
        potionState.step = 3;
        updateBrewingSteps();
        checkPotionResult();
    }, 4500);
}

function checkPotionResult() {
    const correctRecipe = ['æ³‰æ°´', 'æ¤ç‰©', 'ç‰¹æ®Š']; // æ­£ç¡®é…æ–¹ï¼šæ³‰æ°´ + å¤œå…‰è˜‘è‡ + åœ°å¿ƒä¹‹ç«ç§
    
    const isCorrect = potionState.ingredients.length === 3 && 
                     potionState.ingredients[0] === correctRecipe[0] &&
                     potionState.ingredients[1] === correctRecipe[1] &&
                     potionState.ingredients[2] === correctRecipe[2];
    
    const brewBtn = document.getElementById('brew-btn');
    
    if (isCorrect) {
        showPotionMessage("ğŸ‰ ç‚¼åˆ¶æˆåŠŸï¼è·å¾—äº†'ç¿ ç‰åœ£æ°´'ï¼æ¶²ä½“å‘å‡ºå¹½ç»¿è‰²çš„å…‰èŠ’ã€‚", "success");
        document.getElementById('potion-content').innerHTML = "ğŸ’š ç¿ ç‰åœ£æ°´ - æ•£å‘ç€å¥‡å¼‚çš„èƒ½é‡";
        document.getElementById('potion-content').style.color = "#32cd32";
    } else {
        showPotionMessage("ğŸ’¥ ç‚¼åˆ¶å¤±è´¥ï¼æ¶²ä½“å˜æˆäº†æµ‘æµŠçš„é»‘è‰²ã€‚é…æ–¹ä¼¼ä¹ä¸å¯¹...", "error");
        document.getElementById('potion-content').innerHTML = "âš« å¤±è´¥çš„è¯å‰‚ - æ•£å‘ç€æ¶è‡­";
        document.getElementById('potion-content').style.color = "#8b4513";
    }
    
    potionState.isBrewing = false;
    brewBtn.disabled = false;
    brewBtn.textContent = "å¼€å§‹ç‚¼åˆ¶";
}

function resetPotion() {
    if (potionState.isBrewing) {
        showPotionMessage("æ­£åœ¨ç‚¼åˆ¶ä¸­ï¼Œæ— æ³•æ¸…ç©ºï¼", "error");
        return;
    }
    
    potionState.ingredients = [];
    potionState.step = 0;
    updateCauldron();
    updateBrewingSteps();
    showPotionMessage("å©åŸšå·²æ¸…ç©º", "error");
    
    const messageDiv = document.getElementById('potion-message');
    messageDiv.innerHTML = '';
}

function readFormula() {
    showPotionMessage(`
        ã€Šç¿ ç‰ä¹‹ç§˜ã€‹é…æ–¹ï¼š<br>
        â€¢ å¤„å¥³åœ°ä¹‹æ³ª (æ³‰æ°´) ğŸ’§<br>
        â€¢ å¤œå…‰è˜‘è‡ ğŸŒ¿<br>  
        â€¢ åœ°å¿ƒä¹‹ç«ç§ ğŸ”¥<br><br>
        ç‚¼åˆ¶æ­¥éª¤å¿…é¡»ä¸¥æ ¼æŒ‰ç…§é¡ºåºï¼
    `, "success");
}

function showPotionMessage(message, type) {
    const messageDiv = document.getElementById('potion-message');
    messageDiv.innerHTML = `<div class="${type}-message">${message}</div>`;
}
     
        
    </script>
</body>
</html>
