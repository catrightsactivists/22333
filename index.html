<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘æ°´åº„å›­çš„ç§˜å¯†</title>
    <style>
        /* [ä¹‹å‰çš„æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜] */
        /* åŸºç¡€æ ·å¼ */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Times New Roman', serif;
            background-color: black;
            color: #e0d3b8;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            cursor: default;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* å¼€åœºæ–‡å­— */
        #opening-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8em;
            text-align: center;
            opacity: 0;
            z-index: 99;
            text-shadow: 0 0 10px rgba(224, 211, 184, 0.7);
            animation: fadeInOut 6s ease-in-out forwards;
            pointer-events: none;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            30% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* å¤§å…è§†å›¾ */
        #hall-view {
            width: 80vmin;
            height: 80vmin;
            position: relative;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #2a1f1a;
        }

        /* äº¤äº’æŒ‰é’® */
        .interaction-dot {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: rgba(224, 211, 184, 0.3);
            border: 2px solid #e0d3b8;
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .interaction-dot:hover {
            background-color: rgba(224, 211, 184, 0.7);
            transform: translate(-50%, -50%) scale(1.2);
        }

        /* æŒ‰é’®æç¤ºæ–‡å­— */
        .dot-tooltip {
            position: absolute;
            background-color: rgba(42, 31, 26, 0.9);
            color: #e0d3b8;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 20;
            border: 1px solid #e0d3b8;
        }

        .interaction-dot:hover .dot-tooltip {
            opacity: 1;
        }

        /* ç‰¹å†™è§†å›¾ */
        #closeup-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #2a1f1a;
            transition: opacity 1s ease-in-out;
        }

        #closeup-view.active {
            opacity: 1;
            pointer-events: all;
        }

        /* è¿”å›æŒ‰é’® */
        #return-button {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: rgba(90, 70, 50, 0.7);
            color: #e0d3b8;
            border: 1px solid #e0d3b8;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: inherit;
            z-index: 30;
        }

        #return-button:hover {
            background-color: rgba(120, 90, 60, 0.9);
        }

        #closeup-view.active #return-button {
            opacity: 1;
        }

        /* å¼€å§‹æ¸¸æˆæŒ‰é’®çš„ç‰¹æ®Šæ ·å¼ */
        #start-dot .dot-tooltip {
            font-style: italic;
            color: #a08c6c;
        }

        /* å­é¡µé¢äº¤äº’å…ƒç´ æ ·å¼ */
        .interactive-element {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interactive-element:hover {
            transform: scale(1.05);
        }

        .puzzle-interface {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(42, 31, 26, 0.95);
            padding: 30px;
            border: 2px solid #e0d3b8;
            border-radius: 10px;
            min-width: 300px;
            z-index: 40;
        }

        .puzzle-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
            color: #d4af37;
        }

        .puzzle-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .puzzle-button {
            padding: 8px 16px;
            background-color: rgba(90, 70, 50, 0.7);
            color: #e0d3b8;
            border: 1px solid #e0d3b8;
            cursor: pointer;
            font-family: inherit;
        }

        .puzzle-button:hover {
            background-color: rgba(120, 90, 60, 0.9);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="opening-text">ä½ åœ¨ä¸€ä¸ªé™Œç”Ÿçš„ä¹¦æˆ¿ä¸­é†’æ¥ï¼Œè¯·å°è¯•æ¢ç´¢æ•´ä¸ªæˆ¿é—´ï¼Œæ‰¾å›ä¸¢å¤±çš„è®°å¿†</div>
        <div id="hall-view"></div>
        <div id="closeup-view">
            <button id="return-button">â† è¿”å›å¤§å…</button>
        </div>
    </div>

    <script>
        // ==================== å›¾ç‰‡é…ç½®åŒºåŸŸ ====================
        const IMAGES = {
            HALL: 'back.jpg',
            DESK: 'bigdesk.jpg',
            DOOR: 'door.jpg',
            PAINTING: 'paint.jpg',
            MAP: 'map.jpg',
            FAMILY_TREE: 'familytree.jpg',
            POTION_TABLE: 'desk.jpg'
        };

        // ==================== å­é¡µé¢äº¤äº’é…ç½® ====================
        const PAGE_INTERACTIONS = {
            // ä¹¦æ¡Œé¡µé¢äº¤äº’
            desk: {
                background: IMAGES.DESK,
                interactions: [
                    {
                        type: 'clickable',
                        element: '<div class="interactive-element" style="width: 100px; height: 100px; top: 30%; left: 25%; background-color: rgba(139, 69, 19, 0.5); border: 2px dashed #8b4513; border-radius: 5px;"></div>',
                        action: () => showPuzzle('ä¹¦æ¡ŒæŠ½å±‰', 'ä½ å‘ç°äº†ä¸€ä¸ªä¸Šé”çš„æŠ½å±‰ã€‚éœ€è¦æ‰¾åˆ°é’¥åŒ™æ‰èƒ½æ‰“å¼€ã€‚', [
                            { text: 'å°è¯•æ’¬å¼€', action: () => alert('æ’¬é”å¤±è´¥äº†ï¼è¿™éœ€è¦ä¸“é—¨çš„å·¥å…·ã€‚') },
                            { text: 'å¯»æ‰¾é’¥åŒ™', action: () => alert('ä½ å†³å®šåœ¨æˆ¿é—´å…¶ä»–åœ°æ–¹å¯»æ‰¾é’¥åŒ™ã€‚') },
                            { text: 'æš‚æ—¶æ”¾å¼ƒ', action: () => closePuzzle() }
                        ])
                    },
                    {
                        type: 'clickable',
                        element: '<div class="interactive-element" style="width: 80px; height: 120px; top: 45%; left: 60%; background-color: rgba(106, 90, 205, 0.5); border: 2px dashed #6a5acd; border-radius: 3px;"></div>',
                        action: () => showMessage('ä½ æ‰¾åˆ°äº†ä¸€æœ¬æ—¥è®°', 'æ—¥è®°ä¸­è®°è½½ç€å®¶æ—çš„ç§˜å¯†... "é‚£æ³‰æ°´å¹¶éæ©èµï¼Œè€Œæ˜¯è¯…å’’çš„æºå¤´..."')
                    }
                ]
            },

            // å¤§é—¨é¡µé¢äº¤äº’
            door: {
                background: IMAGES.DOOR,
                interactions: [
                    {
                        type: 'puzzle',
                        element: '',
                        action: () => showDoorPuzzle()
                    }
                ]
            },

            // æ²¹ç”»é¡µé¢äº¤äº’
            painting: {
                background: IMAGES.PAINTING,
                interactions: [
                    {
                        type: 'puzzle',
                        element: '<div class="interactive-element" style="width: 120px; height: 80px; top: 40%; left: 50%; background-color: rgba(255, 215, 0, 0.3); border: 2px dashed #ffd700; border-radius: 5px;"></div>',
                        action: () => showDoorPuzzle()
                    }
                ]
            },

            // åœ°å›¾é¡µé¢äº¤äº’
            map: {
                background: IMAGES.MAP,
                interactions: [
                    {
                        type: 'clickable',
                        element: '<div class="interactive-element" style="width: 60px; height: 60px; top: 35%; left: 50%; background-color: rgba(220, 20, 60, 0.4); border-radius: 50%;"></div>',
                        action: () => showMessage('åº„å›­ä½ç½®', 'åœ°å›¾æ˜¾ç¤ºåº„å›­ä½äºä¸–ç•Œçš„æ­£ä¸­å¿ƒï¼Œè¿™æ˜¾ç„¶ä¸ç¬¦åˆåœ°ç†å¸¸è¯†...')
                    }
                ]
            },

            // å®¶æ—æ ‘é¡µé¢äº¤äº’
            'family-tree': {
                background: IMAGES.FAMILY_TREE,
                interactions: [
                    {
                        type: 'clickable',
                        element: '<div class="interactive-element" style="width: 40px; height: 40px; top: 45%; left: 40%; background-color: rgba(178, 34, 34, 0.5); border-radius: 50%;"></div>',
                        action: () => showMessage('è¢«åˆ’æ‰çš„åå­—', 'è¿™ä¸ªå®¶æ—æˆå‘˜åœ¨25å²æ—¶çªç„¶æ­»äº¡ï¼Œæ­»å› ä¸æ˜...')
                    }
                ]
            },

            // é­”è¯æ¡Œå­é¡µé¢äº¤äº’
            'potion-table': {
                background: IMAGES.POTION_TABLE,
                interactions: [
                    {
                        type: 'clickable',
                        element: '<div class="interactive-element" style="width: 60px; height: 80px; top: 40%; left: 40%; background-color: rgba(50, 205, 50, 0.3); border: 2px dashed #32cd32; border-radius: 8px;"></div>',
                        action: () => showMessage('ç‚¼é‡‘æœ¯æ‰‹ç¨¿', 'ã€Šç¿ ç‰ä¹‹ç§˜ã€‹ï¼š"å–å¤„å¥³åœ°ä¹‹æ³ªï¼Œä»¥ä¸ç­ä¹‹ç«æ…¢ç‚–ï¼Œç›´è‡³è’¸å»å…¶å½¢ï¼Œç‹¬ç•™å…¶é­‚..."')
                    },
                    {
                        type: 'clickable',
                        element: '<div class="interactive-element" style="width: 40px; height: 40px; top: 60%; left: 70%; background-color: rgba(255, 215, 0, 0.4); border-radius: 50%;"></div>',
                        action: () => showMessage('ç¥ç§˜è¯å‰‚', 'ç“¶ä¸­æ®‹ç•™ç€å‘å‡ºå¹½ç»¿å…‰èŠ’çš„æ¶²ä½“ã€‚ä½ æ„Ÿå—åˆ°ä¸€è‚¡å¥‡å¼‚çš„èƒ½é‡ã€‚')
                    }
                ]
            }
        };

        // ==================== å¢™é¢é…ç½® ====================
        const walls = [
            { 
                id: 'desk', 
                name: 'ä¹¦æ¡Œ', 
                hint: 'å®¶ä¸»çš„ä¹¦æ¡Œä¸æ¡£æ¡ˆ',
                position: 'north',
                tooltipPos: 'bottom'
            },
            { 
                id: 'door', 
                name: 'å¤§é—¨', 
                hint: 'ä¸€æ‰‡å¸¦æœ‰ä¸ƒä¸ªé”å­”çš„é»„é“œå¤§é—¨',
                position: 'northwest',
                tooltipPos: 'bottom-right'
            },
            { 
                id: 'painting', 
                name: 'æ²¹ç”»', 
                hint: 'ä¸€å¹…å·¨å¤§çš„å¤å…¸æ²¹ç”»',
                position: 'northeast',
                tooltipPos: 'bottom-left'
            },
            { 
                id: 'map', 
                name: 'åœ°å›¾', 
                hint: 'ä»¥åº„å›­ä¸ºä¸­å¿ƒçš„ä¸–ç•Œåœ°å›¾',
                position: 'east',
                tooltipPos: 'left'
            },
            { 
                id: 'family-tree', 
                name: 'å®¶æ—æ ‘', 
                hint: 'ä¸€ä»½è¢«æ±¡æŸçš„å®¶æ—è°±ç³»',
                position: 'southeast',
                tooltipPos: 'top-left'
            },
            { 
                id: 'potion-table', 
                name: 'é­”è¯æ¡Œå­', 
                hint: 'ç‚¼é‡‘æœ¯å·¥ä½œå°ä¸æ‰‹ç¨¿',
                position: 'south',
                tooltipPos: 'top'
            },
            { 
                id: 'start', 
                name: 'å¼€å§‹æ¸¸æˆ', 
                hint: 'ç‚¹å‡»è¿™é‡Œå¼€å§‹æ¢ç´¢',
                position: 'southwest',
                tooltipPos: 'top-right',
                isStart: true
            }
        ];

        // ==================== å·¥å…·å‡½æ•° ====================
        function getPosition(position) {
            const radius = 40;
            switch(position) {
                case 'north': return { x: 50, y: 50 - radius };
                case 'northeast': return { x: 50 + radius * 0.707, y: 50 - radius * 0.707 };
                case 'east': return { x: 50 + radius, y: 50 };
                case 'southeast': return { x: 50 + radius * 0.707, y: 50 + radius * 0.707 };
                case 'south': return { x: 50, y: 50 + radius };
                case 'southwest': return { x: 50 - radius * 0.707, y: 50 + radius * 0.707 };
                case 'west': return { x: 50 - radius, y: 50 };
                case 'northwest': return { x: 50 - radius * 0.707, y: 50 - radius * 0.707 };
                default: return { x: 50, y: 50 };
            }
        }

        function getTooltipPosition(tooltipPos) {
            switch(tooltipPos) {
                case 'top': return { top: '-40px', left: '50%', transform: 'translateX(-50%)' };
                case 'top-right': return { top: '-40px', left: '20px' };
                case 'top-left': return { top: '-40px', right: '20px' };
                case 'bottom': return { bottom: '-40px', left: '50%', transform: 'translateX(-50%)' };
                case 'bottom-right': return { bottom: '-40px', left: '20px' };
                case 'bottom-left': return { bottom: '-40px', right: '20px' };
                case 'left': return { top: '50%', right: '30px', transform: 'translateY(-50%)' };
                case 'right': return { top: '50%', left: '30px', transform: 'translateY(-50%)' };
                default: return { top: '-40px', left: '50%', transform: 'translateX(-50%)' };
            }
        }

        // ==================== äº¤äº’åŠŸèƒ½å‡½æ•° ====================
        function showPuzzle(title, description, buttons) {
            closePuzzle(); // å…ˆå…³é—­å¯èƒ½å­˜åœ¨çš„å…¶ä»–è°œé¢˜
            const puzzleHTML = `
                <div class="puzzle-interface">
                    <div class="puzzle-title">${title}</div>
                    <div>${description}</div>
                    <div class="puzzle-controls">
                        ${buttons.map(btn => 
                            `<button class="puzzle-button" onclick="(${btn.action.toString()})()">${btn.text}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
            document.getElementById('closeup-view').insertAdjacentHTML('beforeend', puzzleHTML);
        }

        function closePuzzle() {
            const puzzles = document.querySelectorAll('.puzzle-interface');
            puzzles.forEach(puzzle => puzzle.remove());
        }

        function showMessage(title, message) {
            alert(`${title}\n\n${message}`);
        }

        function showDoorPuzzle() {
            showPuzzle('ä¸ƒé‡é”é’¥', 'é—¨ä¸Šæœ‰ä¸ƒä¸ªé”å­”ï¼Œæ¯ä¸ªéƒ½å¯¹åº”ç€ä¸åŒçš„ç½ªå­½ç¬¦å·ã€‚ä½ éœ€è¦æ‰¾åˆ°æ­£ç¡®çš„å¼€å¯é¡ºåºã€‚', [
                { text: 'æ£€æŸ¥é”å­”', action: () => showMessage('é”å­”æ£€æŸ¥', 'ä¸ƒä¸ªé”å­”æ’åˆ—æˆå¥‡ç‰¹çš„å›¾æ¡ˆï¼šå‚²æ…¢ã€å«‰å¦’ã€æ„¤æ€’ã€æ‡’æƒ°ã€è´ªå©ªã€æš´é£Ÿã€è‰²æ¬²ã€‚') },
                { text: 'å°è¯•å¼€é”', action: () => showMessage('å¼€é”å°è¯•', 'ä½ éœ€è¦å…ˆåœ¨å…¶ä»–åœ°æ–¹æ‰¾åˆ°å¼€é”çš„çº¿ç´¢ã€‚') },
                { text: 'æ”¾å¼ƒ', action: () => closePuzzle() }
            ]);
        }

        // ==================== ä¸»è¦æ¸¸æˆå‡½æ•° ====================
        function initGame() {
            const hallView = document.getElementById('hall-view');
            const closeupView = document.getElementById('closeup-view');
            const returnButton = document.getElementById('return-button');

            hallView.style.backgroundImage = `url('${IMAGES.HALL}')`;

            walls.forEach(wall => {
                const dot = document.createElement('div');
                dot.className = 'interaction-dot';
                dot.dataset.wallId = wall.id;
                
                const pos = getPosition(wall.position);
                dot.style.left = `${pos.x}%`;
                dot.style.top = `${pos.y}%`;

                const tooltip = document.createElement('div');
                tooltip.className = 'dot-tooltip';
                tooltip.textContent = wall.name;
                
                const tooltipPos = getTooltipPosition(wall.tooltipPos);
                Object.keys(tooltipPos).forEach(key => {
                    tooltip.style[key] = tooltipPos[key];
                });

                dot.appendChild(tooltip);

                dot.addEventListener('click', (event) => {
                    event.stopPropagation();
                    if (wall.isStart) {
                        dot.style.display = 'none';
                        document.querySelectorAll('.interaction-dot:not([data-wall-id="start"])').forEach(otherDot => {
                            otherDot.style.display = 'block';
                        });
                    } else {
                        showCloseup(wall);
                    }
                });

                if (!wall.isStart) {
                    dot.style.display = 'none';
                }

                hallView.appendChild(dot);
            });

            returnButton.addEventListener('click', () => {
                closeupView.classList.remove('active');
                closeupView.style.backgroundImage = ''; // æ¸…é™¤èƒŒæ™¯å›¾
                setTimeout(() => {
                    hallView.style.opacity = 1;
                }, 500);
            });

            setTimeout(() => {
                hallView.style.opacity = 1;
            }, 6000);
        }

        function showCloseup(wall) {
            const hallView = document.getElementById('hall-view');
            const closeupView = document.getElementById('closeup-view');
            
            hallView.style.opacity = 0;
            
            // æ¸…ç©ºä¹‹å‰çš„äº¤äº’å…ƒç´ å’ŒèƒŒæ™¯
            closeupView.innerHTML = '<button id="return-button">â† è¿”å›å¤§å…</button>';
            closeupView.style.backgroundImage = '';
            
            // è·å–è¯¥é¡µé¢çš„äº¤äº’é…ç½®
            const pageConfig = PAGE_INTERACTIONS[wall.id];
            
            if (pageConfig && pageConfig.background) {
                // è®¾ç½®èƒŒæ™¯å›¾ç‰‡
                closeupView.style.backgroundImage = `url('${pageConfig.background}')`;
                
                // æ·»åŠ äº¤äº’å…ƒç´ 
                if (pageConfig.interactions) {
                    pageConfig.interactions.forEach(interaction => {
                        if (interaction.element) {
                            closeupView.insertAdjacentHTML('beforeend', interaction.element);
                        }
                        
                        // ä¸ºäº¤äº’å…ƒç´ ç»‘å®šäº‹ä»¶
                        if (interaction.type === 'clickable') {
                            const elements = closeupView.querySelectorAll('.interactive-element');
                            const lastElement = elements[elements.length - 1];
                            if (lastElement) {
                                lastElement.addEventListener('click', interaction.action);
                            }
                        } else if (interaction.type === 'puzzle') {
                            // ç«‹å³æ‰§è¡Œè°œé¢˜åŠŸèƒ½
                            setTimeout(() => interaction.action(), 100);
                        }
                    });
                }
            } else {
                // é»˜è®¤æ˜¾ç¤º - ç°åœ¨æ¯ä¸ªé¡µé¢éƒ½ä¼šæ˜¾ç¤ºè‡ªå·±çš„åå­—
                closeupView.innerHTML += `
                    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center;">
                        <h2>${wall.name}</h2>
                        <p>${wall.hint}</p>
                        <p style="margin-top: 20px; font-style: italic; color: #a08c6c;">
                            ã€${wall.name} é¡µé¢ã€‘<br>
                            ï¼ˆç­‰å¾…æ·»åŠ ç‰¹å†™å›¾ç‰‡å’Œäº’åŠ¨å†…å®¹ï¼‰
                        </p>
                    </div>
                `;
            }

            // é‡æ–°ç»‘å®šè¿”å›æŒ‰é’®äº‹ä»¶
            document.getElementById('return-button').addEventListener('click', () => {
                closeupView.classList.remove('active');
                closeupView.style.backgroundImage = '';
                setTimeout(() => {
                    hallView.style.opacity = 1;
                }, 500);
            });

            setTimeout(() => {
                closeupView.classList.add('active');
            }, 500);
        }

        window.addEventListener('load', initGame);
        // ==================== å¤§é—¨é¡µé¢æ•°æ®é…ç½® ====================
const DOOR_CONFIG = {
    // ä¸ƒå®—ç½ªç¬¦å·é…ç½®
    sins: [
        { id: 'pride', symbol: 'ğŸ¦', name: 'å‚²æ…¢', latin: 'Superbia' },
        { id: 'envy', symbol: 'ğŸ¦‹', name: 'å«‰å¦’', latin: 'Invidia' },
        { id: 'wrath', symbol: 'ğŸ‚', name: 'æ„¤æ€’', latin: 'Ira' },
        { id: 'sloth', symbol: 'ğŸ¦¥', name: 'æ‡’æƒ°', latin: 'Acedia' },
        { id: 'greed', symbol: 'ğŸ¦Š', name: 'è´ªå©ª', latin: 'Avaritia' },
        { id: 'gluttony', symbol: 'ğŸ—', name: 'æš´é£Ÿ', latin: 'Gula' },
        { id: 'lust', symbol: 'ğŸ¦‚', name: 'è‰²æ¬²', latin: 'Luxuria' }
    ],
    // æ­£ç¡®çš„å¼€å¯é¡ºåºï¼ˆé€†å¡å·´æ‹‰é¡ºåºï¼‰
    correctOrder: ['gluttony', 'lust', 'greed', 'sloth', 'wrath', 'envy', 'pride'],
    // æç¤ºä¿¡æ¯
    hints: [
        "æç¤ºï¼šé¡ºåºä¸ç‰©è´¨çš„å •è½æœ‰å…³",
        "æç¤ºï¼šæƒ³æƒ³ä»€ä¹ˆæ˜¯'é€†å¡å·´æ‹‰'", 
        "æç¤ºï¼šä»æœ€åŸºç¡€çš„æ¬²æœ›å¼€å§‹",
        "æç¤ºï¼šæš´é£Ÿ â†’ è‰²æ¬² â†’ è´ªå©ª â†’ æ‡’æƒ° â†’ æ„¤æ€’ â†’ å«‰å¦’ â†’ å‚²æ…¢"
    ]
};

// ==================== å¤§é—¨é¡µé¢æ¸¸æˆçŠ¶æ€ ====================
let doorGameState = {
    currentSequence: [],
    availableSins: [...DOOR_CONFIG.sins],
    hintsUsed: 0,
    attempts: 0
};

// ==================== å¤§é—¨é¡µé¢äº¤äº’å‡½æ•° ====================
function showDoorPuzzle() {
    const doorHTML = `
        <div class="door-interface">
            <div class="door-title">ä¸ƒé‡é”é’¥</div>
            <div class="door-subtitle">"Sicut Superius, Inferius"<br>å¦‚å…¶åœ¨ä¸Šï¼Œå¦‚å…¶åœ¨ä¸‹</div>
            
            <div class="locks-container" id="locks-container">
                ${Array(7).fill(0).map((_, index) => `
                    <div class="lock-slot" data-slot-index="${index}" onclick="placeSymbol(${index})">
                        ${doorGameState.currentSequence[index] ? 
                            DOOR_CONFIG.sins.find(sin => sin.id === doorGameState.currentSequence[index]).symbol : 
                            '?'
                        }
                    </div>
                `).join('')}
            </div>

            <div class="symbols-container" id="symbols-container">
                ${doorGameState.availableSins.map(sin => `
                    <div class="sin-symbol" draggable="true" data-sin-id="${sin.id}"
                         onclick="selectSymbol('${sin.id}')"
                         title="${sin.name} - ${sin.latin}">
                        ${sin.symbol}
                    </div>
                `).join('')}
            </div>

            <div class="controls-container">
                <button class="door-button" onclick="checkSequence()" 
                        ${doorGameState.currentSequence.length !== 7 ? 'disabled' : ''}>
                    å°è¯•å¼€é”
                </button>
                <button class="door-button" onclick="resetSequence()">é‡ç½®é¡ºåº</button>
                <button class="door-button" onclick="showHint()">
                    æç¤º (${3 - doorGameState.hintsUsed}æ¬¡å‰©ä½™)
                </button>
            </div>

            <div id="message-area"></div>
            <div class="hint-text">å°è¯•æ¬¡æ•°: ${doorGameState.attempts}</div>
        </div>
    `;

    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', doorHTML);
    setupDragAndDrop();
}

function setupDragAndDrop() {
    const symbols = document.querySelectorAll('.sin-symbol');
    const slots = document.querySelectorAll('.lock-slot');

    symbols.forEach(symbol => {
        symbol.addEventListener('dragstart', handleDragStart);
        symbol.addEventListener('dragend', handleDragEnd);
    });

    slots.forEach(slot => {
        slot.addEventListener('dragover', handleDragOver);
        slot.addEventListener('drop', handleDrop);
    });
}

function handleDragStart(e) {
    e.dataTransfer.setData('text/plain', e.target.dataset.sinId);
    e.target.classList.add('dragging');
}

function handleDragEnd(e) {
    e.target.classList.remove('dragging');
}

function handleDragOver(e) {
    e.preventDefault();
}

function handleDrop(e) {
    e.preventDefault();
    const sinId = e.dataTransfer.getData('text/plain');
    const slotIndex = parseInt(e.target.dataset.slotIndex);
    placeSymbolInSlot(sinId, slotIndex);
}

function selectSymbol(sinId) {
    const firstEmptySlot = document.querySelector('.lock-slot:not(.filled)');
    if (firstEmptySlot) {
        const slotIndex = parseInt(firstEmptySlot.dataset.slotIndex);
        placeSymbolInSlot(sinId, slotIndex);
    }
}

function placeSymbol(slotIndex) {
    if (doorGameState.currentSequence[slotIndex]) {
        removeSymbolFromSlot(slotIndex);
    }
}

function placeSymbolInSlot(sinId, slotIndex) {
    if (doorGameState.currentSequence[slotIndex]) {
        removeSymbolFromSlot(slotIndex);
    }

    doorGameState.currentSequence[slotIndex] = sinId;
    const sin = DOOR_CONFIG.sins.find(s => s.id === sinId);
    
    const slot = document.querySelector(`[data-slot-index="${slotIndex}"]`);
    slot.innerHTML = sin.symbol;
    slot.classList.add('filled');
    slot.title = `${sin.name} - ${sin.latin}`;

    const symbolElement = document.querySelector(`[data-sin-id="${sinId}"]`);
    if (symbolElement) {
        symbolElement.classList.add('used');
        symbolElement.style.cursor = 'not-allowed';
        symbolElement.draggable = false;
    }

    const checkButton = document.querySelector('.door-button');
    if (doorGameState.currentSequence.filter(Boolean).length === 7) {
        checkButton.disabled = false;
    }
}

function removeSymbolFromSlot(slotIndex) {
    const sinId = doorGameState.currentSequence[slotIndex];
    if (sinId) {
        const symbolElement = document.querySelector(`[data-sin-id="${sinId}"]`);
        if (symbolElement) {
            symbolElement.classList.remove('used');
            symbolElement.style.cursor = 'grab';
            symbolElement.draggable = true;
        }

        doorGameState.currentSequence[slotIndex] = null;
        const slot = document.querySelector(`[data-slot-index="${slotIndex}"]`);
        slot.innerHTML = '?';
        slot.classList.remove('filled');
        slot.title = '';

        const checkButton = document.querySelector('.door-button');
        checkButton.disabled = true;
    }
}

function checkSequence() {
    doorGameState.attempts++;
    const currentSequence = doorGameState.currentSequence.filter(Boolean);
    
    if (currentSequence.length !== 7) {
        showMessage('è¯·å¡«æ»¡æ‰€æœ‰ä¸ƒä¸ªé”å­”', 'error');
        return;
    }

    const isCorrect = currentSequence.every((sinId, index) => 
        sinId === DOOR_CONFIG.correctOrder[index]
    );

    if (isCorrect) {
        showMessage('æˆåŠŸäº†ï¼å¤§é—¨ç¼“ç¼“æ‰“å¼€...', 'success');
        setTimeout(() => {
            showMessage('é—¨åæ˜¯ä¸€æ¡é€šå¾€æœªçŸ¥çš„é€šé“...', 'success');
        }, 2000);
    } else {
        showMessage('é”å­”å‘å‡ºæ²‰é‡çš„å“å£°ï¼Œä½†é—¨æ²¡æœ‰æ‰“å¼€ã€‚é¡ºåºä¼¼ä¹ä¸å¯¹...', 'error');
        const correctPositions = currentSequence.filter((sinId, index) => 
            sinId === DOOR_CONFIG.correctOrder[index]
        ).length;
        showMessage(`æœ‰ ${correctPositions} ä¸ªç¬¦å·åœ¨æ­£ç¡®çš„ä½ç½®ä¸Š`, 'error');
    }

    updateAttemptsDisplay();
}

function resetSequence() {
    doorGameState.currentSequence = [];
    doorGameState.availableSins = [...DOOR_CONFIG.sins];
    
    const slots = document.querySelectorAll('.lock-slot');
    slots.forEach(slot => {
        slot.innerHTML = '?';
        slot.classList.remove('filled');
        slot.title = '';
    });

    const symbols = document.querySelectorAll('.sin-symbol');
    symbols.forEach(symbol => {
        symbol.classList.remove('used');
        symbol.style.cursor = 'grab';
        symbol.draggable = true;
    });

    const checkButton = document.querySelector('.door-button');
    checkButton.disabled = true;

    showMessage('é¡ºåºå·²é‡ç½®', 'error');
}

function showHint() {
    if (doorGameState.hintsUsed >= 3) {
        showMessage('æ²¡æœ‰æ›´å¤šæç¤ºäº†', 'error');
        return;
    }

    doorGameState.hintsUsed++;
    const hint = DOOR_CONFIG.hints[doorGameState.hintsUsed - 1];
    showMessage(hint, 'error');
    
    const hintButton = document.querySelector('.door-button:last-child');
    hintButton.textContent = `æç¤º (${3 - doorGameState.hintsUsed}æ¬¡å‰©ä½™)`;
    
    if (doorGameState.hintsUsed >= 3) {
        hintButton.disabled = true;
    }
}

function showMessage(message, type) {
    const messageArea = document.getElementById('message-area');
    messageArea.innerHTML = `<div class="${type}-message">${message}</div>`;
    
    if (type === 'success') {
        messageArea.classList.add('success-message');
        messageArea.classList.remove('error-message');
    } else {
        messageArea.classList.add('error-message');
        messageArea.classList.remove('success-message');
    }
}

function updateAttemptsDisplay() {
    const attemptsDisplay = document.querySelector('.hint-text');
    if (attemptsDisplay) {
        attemptsDisplay.textContent = `å°è¯•æ¬¡æ•°: ${doorGameState.attempts}`;
    }
}
        // ==================== æ²¹ç”»é¡µé¢ ====================
function showPaintingPuzzle() {
    const paintingHTML = `
        <div class="door-interface">
            <div class="door-title">ç¥ç§˜çš„å¤å…¸æ²¹ç”»</div>
            <div class="door-subtitle">"å®¶æ—å‘ç°åœ£æ°´çš„ç¥åœ£æ—¶åˆ»"</div>
            
            <div class="painting-container">
                <div class="painting-area" id="painting-area">
                    <div class="painting-hotspot" style="top: 30%; left: 40%;" onclick="examineEyes()">
                        ğŸ‘ï¸ äººç‰©çš„çœ¼ç¥
                    </div>
                    <div class="painting-hotspot" style="top: 60%; left: 25%;" onclick="examineBottle()">
                        ğŸ¶ åœ£æ°´ç“¶
                    </div>
                    <div class="painting-hotspot" style="top: 70%; left: 65%;" onclick="examineBackground()">
                        ğŸï¸ èƒŒæ™¯ç¬¦å·
                    </div>
                    <div class="painting-hotspot" style="top: 45%; left: 75%;" onclick="examineFrame()">
                        ğŸ–¼ï¸ ç”»æ¡†åˆ»æ–‡
                    </div>
                </div>
            </div>

            <div class="controls-container">
                <button class="door-button" onclick="useUltraviolet()">ä½¿ç”¨ç´«å¤–ç¯</button>
                <button class="door-button" onclick="cleanPainting()">æ¸…ç†ç”»é¢</button>
                <button class="door-button" onclick="checkReflection()">æ£€æŸ¥åå…‰</button>
            </div>

            <div id="painting-message" class="hint-text"></div>
            <div class="hint-text">å·²å‘ç°çº¿ç´¢: <span id="clue-count">0</span>/4</div>
        </div>
    `;
    
    document.getElementById('closeup-view').insertAdjacentHTML('beforeend', paintingHTML);
    resetPaintingState();
}

// æ²¹ç”»é¡µé¢çŠ¶æ€
let paintingState = {
    cluesFound: 0,
    uvUsed: false,
    cleaned: false
};

function resetPaintingState() {
    paintingState = {
        cluesFound: 0,
        uvUsed: false,
        cleaned: false
    };
    updateClueCount();
}

function updateClueCount() {
    const countElement = document.getElementById('clue-count');
    if (countElement) {
        countElement.textContent = paintingState.cluesFound;
    }
}

function showPaintingMessage(message, type = 'info') {
    const messageElement = document.getElementById('painting-message');
    if (messageElement) {
        const color = type === 'success' ? '#6b8e23' : type === 'error' ? '#8b4513' : '#e0d3b8';
        messageElement.innerHTML = `<div style="color: ${color}; margin: 10px 0;">${message}</div>`;
    }
}

// æ£€æŸ¥äººç‰©çœ¼ç¥
function examineEyes() {
    if (!paintingState.cleaned) {
        showPaintingMessage('ç”»é¢å¤ªè„äº†ï¼Œçœ‹ä¸æ¸…äººç‰©çš„çœ¼ç¥ç»†èŠ‚ã€‚ä¹Ÿè®¸éœ€è¦å…ˆæ¸…ç†ä¸€ä¸‹ï¼Ÿ', 'error');
        return;
    }
    
    showPaintingMessage('ä½ å‘ç°ç”»ä¸­äººç‰©çš„çœ¼ç¥å¼‚å¸¸ç©ºæ´ï¼Œç³å­”ä¸­ä¼¼ä¹åå°„ç€æŸç§å‡ ä½•å›¾æ¡ˆ...', 'success');
    addClue();
}

// æ£€æŸ¥åœ£æ°´ç“¶
function examineBottle() {
    showPaintingMessage('åœ£æ°´ç“¶ä¸­æµåŠ¨ç€å¹½ç»¿è‰²çš„æ¶²ä½“ï¼Œç“¶èº«ä¸Šåˆ»ç€:"EX INFERNO AD CAELUM"ï¼ˆä»åœ°ç‹±åˆ°å¤©å ‚ï¼‰', 'success');
    addClue();
}

// æ£€æŸ¥èƒŒæ™¯ç¬¦å·
function examineBackground() {
    if (!paintingState.uvUsed) {
        showPaintingMessage('èƒŒæ™¯çœ‹èµ·æ¥åªæ˜¯æ™®é€šçš„é£æ™¯ï¼Œä½†æ€»è§‰å¾—æœ‰äº›ä¸å¯¹åŠ²...', 'error');
        return;
    }
    
    showPaintingMessage('åœ¨ç´«å¤–çº¿ä¸‹ï¼ŒèƒŒæ™¯æ˜¾ç°å‡ºéšè—çš„ç¬¦å·ï¼šä¸€ä¸ªè¢«å…­èŠ’æ˜ŸåŒ…å›´çš„é»‘æ´å›¾æ¡ˆï¼', 'success');
    addClue();
}

// æ£€æŸ¥ç”»æ¡†åˆ»æ–‡
function examineFrame() {
    showPaintingMessage('ç”»æ¡†å†…ä¾§åˆ»ç€ç»†å°çš„æ–‡å­—ï¼š"ä»–èµäºˆç”Ÿå‘½ï¼Œå´ç´¢å–çµé­‚ã€‚éæ©èµï¼Œå®ä¸ºå€Ÿè´·ã€‚"', 'success');
    addClue();
}

// ä½¿ç”¨ç´«å¤–ç¯
function useUltraviolet() {
    paintingState.uvUsed = true;
    const paintingArea = document.getElementById('painting-area');
    if (paintingArea) {
        paintingArea.style.border = '3px solid #9400d3';
        paintingArea.style.background = 'linear-gradient(45deg, #2a1f1a, #4b0082)';
    }
    showPaintingMessage('ç´«å¤–ç¯ä¸‹ï¼Œç”»é¢æ˜¾ç°å‡ºéšè—çš„ç»†èŠ‚ï¼å¿«å»æ£€æŸ¥èƒŒæ™¯ï¼', 'success');
}

// æ¸…ç†ç”»é¢
function cleanPainting() {
    paintingState.cleaned = true;
    const paintingArea = document.getElementById('painting-area');
    if (paintingArea) {
        paintingArea.style.background = 'rgba(139, 69, 19, 0.1)';
    }
    showPaintingMessage('æ¸…ç†åï¼Œç”»é¢çš„ç»†èŠ‚æ›´åŠ æ¸…æ™°äº†ï¼ç°åœ¨å¯ä»¥æ£€æŸ¥äººç‰©çœ¼ç¥äº†ã€‚', 'success');
}

// æ£€æŸ¥åå…‰
function checkReflection() {
    if (paintingState.cluesFound >= 3) {
        showPaintingMessage('åœ¨ç‰¹å®šè§’åº¦ä¸‹ï¼Œä½ å‘ç°æ²¹ç”»è¡¨é¢åå°„å‡ºä¹¦æˆ¿ä¸­å…¶ä»–ç‰©ä½“çš„å½±åƒï¼Œä¼¼ä¹æš—ç¤ºç€æŸç§è”ç³»...', 'success');
        if (paintingState.cluesFound === 3) {
            addClue(); // ç¬¬å››ä¸ªçº¿ç´¢
        }
    } else {
        showPaintingMessage('éœ€è¦å‘ç°æ›´å¤šçº¿ç´¢æ‰èƒ½çœ‹å‡ºå…¶ä¸­çš„è§„å¾‹...', 'error');
    }
}

function addClue() {
    if (paintingState.cluesFound < 4) {
        paintingState.cluesFound++;
        updateClueCount();
        
        if (paintingState.cluesFound === 4) {
            showPaintingMessage('ğŸ‰ ä½ å‘ç°äº†æ²¹ç”»çš„æ‰€æœ‰ç§˜å¯†ï¼ç”»ä¸­éšè—çš„çœŸç›¸ä»¤äººä¸å®‰...', 'success');
            setTimeout(() => {
                showPaintingMessage('"æˆ‘ä»¬å´‡æ‹œçš„å¹¶éç¥æ˜ï¼Œè€Œæ˜¯å›šç¦æˆ‘ä»¬çš„ç‹±å’ã€‚"', 'success');
            }, 3000);
        }
    }
}
        
    </script>
</body>
</html>
